{"version":3,"file":"index-IqarBBzt.js","sources":["../../src/lib/hostBridge.ts","../../src/lib/helpers.ts","../../src/services/unitService.ts","../../src/services/formationService.ts","../../src/services/nationService.ts","../../src/services/settingsService.ts","../../src/modules/unitEditor.ts","../../src/modules/formationsPanel.ts","../../src/modules/nationsPanel.ts","../../src/lib/theme.ts","../../src/modules/settingsPanel.ts","../../src/modules/statsPanel.ts","../../src/main.ts"],"sourcesContent":["type HostEnvelope<TPayload = unknown> = {\n  type: string;\n  payload?: TPayload;\n};\n\ndeclare global {\n  interface Window {\n    chrome?: {\n      webview?: {\n        postMessage: (data: HostEnvelope) => void;\n        addEventListener: (event: \"message\", handler: (event: { data: HostEnvelope }) => void) => void;\n      };\n    };\n  }\n}\n\ntype HostHandler = (payload: unknown) => void;\n\nclass HostBridge {\n  private listeners = new Map<string, Set<HostHandler>>();\n  public readonly isAvailable: boolean;\n\n  constructor() {\n    this.isAvailable = Boolean(window.chrome?.webview);\n    if (this.isAvailable) {\n      window.chrome?.webview?.addEventListener(\"message\", (event) => this.handleEnvelope(event?.data));\n    } else {\n      console.info(\"[HostBridge] Running without desktop host; messaging will be no-ops.\");\n    }\n  }\n\n  private handleEnvelope(envelope?: HostEnvelope): void {\n    if (!envelope || typeof envelope !== \"object\" || !envelope.type) return;\n    this.emit(envelope.type, envelope.payload);\n  }\n\n  postMessage<TPayload = unknown>(type: string, payload?: TPayload): void {\n    if (!this.isAvailable) {\n      console.warn(`[HostBridge] Skipping \"${type}\" message because WebView host is unavailable.`);\n      return;\n    }\n    window.chrome!.webview!.postMessage({ type, payload });\n  }\n\n  request<TRequest = unknown, TResponse = unknown>(\n    type: string,\n    payload?: TRequest,\n    responseType?: string,\n    timeoutMs = 5000\n  ): Promise<TResponse> {\n    if (!this.isAvailable) {\n      return Promise.reject(new Error(\"Host bridge is not available.\"));\n    }\n    const waitType = responseType ?? type;\n    const waitPromise = this.waitFor<TResponse>(waitType, timeoutMs);\n    this.postMessage(type, payload);\n    return waitPromise;\n  }\n\n  waitFor<TPayload = unknown>(type: string, timeoutMs = 5000): Promise<TPayload> {\n    return new Promise((resolve, reject) => {\n      const handler: HostHandler = (payload) => {\n        this.off(type, handler);\n        clearTimeout(timeoutId);\n        resolve(payload as TPayload);\n      };\n\n      const timeoutId = window.setTimeout(() => {\n        this.off(type, handler);\n        reject(new Error(`Timed out waiting for host payload \"${type}\"`));\n      }, timeoutMs);\n\n      this.on(type, handler);\n    });\n  }\n\n  on<TPayload = unknown>(type: string, handler: (payload: TPayload) => void): () => void {\n    const existing = this.listeners.get(type) ?? new Set<HostHandler>();\n    existing.add(handler as HostHandler);\n    this.listeners.set(type, existing);\n    return () => this.off(type, handler as HostHandler);\n  }\n\n  off(type: string, handler: HostHandler): void {\n    const existing = this.listeners.get(type);\n    if (!existing) return;\n    existing.delete(handler);\n    if (!existing.size) this.listeners.delete(type);\n  }\n\n  private emit(type: string, payload: unknown): void {\n    const set = this.listeners.get(type);\n    if (!set) return;\n    set.forEach((handler) => {\n      try {\n        handler(payload);\n      } catch (error) {\n        console.error(`[HostBridge] Listener for \"${type}\" failed`, error);\n      }\n    });\n  }\n}\n\nexport const hostBridge = new HostBridge();\n","import type { Unit, Formation, Nation } from \"../types\";\n\nexport const valueOrNA = (value: unknown): string => {\n  if (value === undefined || value === null || value === \"\") return \"N/A\";\n  return String(value);\n};\n\nexport const yesNo = (value: unknown): string => {\n  if (value === undefined || value === null) return \"N/A\";\n  if (value === true || value === \"true\") return \"Yes\";\n  if (value === false || value === \"false\") return \"No\";\n  return String(value);\n};\n\nexport const parseBoolish = (value: unknown): boolean | \"\" => {\n  if (value === \"\" || value === undefined || value === null) return \"\";\n  if (value === true || value === \"true\") return true;\n  if (value === false || value === \"false\") return false;\n  return \"\";\n};\n\nexport const createPill = (label: string, value: unknown): HTMLDivElement => {\n  const pill = document.createElement(\"div\");\n  pill.className = \"stat-pill\";\n  const key = document.createElement(\"span\");\n  key.className = \"label\";\n  key.textContent = label;\n  const val = document.createElement(\"span\");\n  val.className = \"strong\";\n  val.textContent = valueOrNA(value);\n  pill.append(key, val);\n  return pill;\n};\n\nexport const sectionTitle = (text: string): HTMLDivElement => {\n  const el = document.createElement(\"div\");\n  el.className = \"section-title\";\n  el.textContent = text;\n  return el;\n};\n\nexport const getTagColor = (\n  kind: \"category\" | \"caliber\",\n  key: string | undefined,\n  weaponTags?: { categories?: Record<string, string>; calibers?: Record<string, string> }\n): string | null => {\n  if (!key || !weaponTags) return null;\n  if (kind === \"category\") return weaponTags.categories?.[key] ?? null;\n  if (kind === \"caliber\") return weaponTags.calibers?.[key] ?? null;\n  return null;\n};\n\nexport const toNumber = (val: unknown): number => {\n  if (typeof val === \"number\") return val;\n  if (typeof val === \"string\") {\n    const m = val.match(/-?\\d+(\\.\\d+)?/);\n    return m ? parseFloat(m[0]) : 0;\n  }\n  return 0;\n};\n\nexport const formatWithUnit = (val: unknown, unit: string): string => {\n  if (val === \"\" || val === undefined || val === null) return \"N/A\";\n  const num = toNumber(val);\n  if (Number.isNaN(num)) return valueOrNA(val);\n  return `${num} ${unit}`;\n};\n\nexport const formatPercent = (val: unknown): string => {\n  if (val === \"\" || val === undefined || val === null) return \"N/A\";\n  const num = toNumber(val);\n  if (Number.isNaN(num)) return valueOrNA(val);\n  return `${num}%`;\n};\n\nexport const formatSpeed = (val: unknown): string => {\n  if (val === \"\" || val === undefined || val === null) return \"N/A\";\n  const mps = toNumber(val);\n  if (Number.isNaN(mps)) return valueOrNA(val);\n  const kph = (mps * 3.6).toFixed(1);\n  return `${mps} m/s (${kph} km/h)`;\n};\n\nexport const formatPoints = (val: unknown): string => {\n  if (val === \"\" || val === undefined || val === null) return \"N/A\";\n  const num = toNumber(val);\n  if (Number.isNaN(num)) return valueOrNA(val);\n  return `${num} pts`;\n};\n\nexport const armorScore = (armor: unknown): number => {\n  const text = typeof armor === \"string\" ? armor.toLowerCase() : \"\";\n  if (!text && typeof armor !== \"number\") return 5;\n  if (text.includes(\"era\") || text.includes(\"composite\") || text.includes(\"heavy\")) return 40;\n  if (text.includes(\"kevlar\") || text.includes(\"lvl\") || text.includes(\"iii\")) return 25;\n  if (text.includes(\"light\")) return 15;\n  return Math.max(5, Math.min(35, toNumber(armor) * 2));\n};\n\nexport const clampScore = (num: number): number => Math.max(0, Math.min(100, Math.round(num)));\n\nexport const deepClone = <T>(obj: T): T => JSON.parse(JSON.stringify(obj));\n\nexport const scoreUnitDetailed = (\n  unit: Unit | undefined\n): { metrics: Record<string, number> } | null => {\n  if (!unit) return null;\n  const guns = Array.isArray(unit.guns) ? unit.guns : [];\n  const caps = unit.capabilities || {};\n  const stats = unit.stats || {};\n  const gren = unit.grenades || {};\n\n  const lethality = clampScore(\n    guns.reduce((sum, g) => sum + toNumber(g.totalAmmo || g.ammoPerSoldier) * 0.4, 0) +\n      toNumber(gren.total) * 2\n  );\n  const survivability = clampScore(armorScore(stats.armor) + toNumber(stats.health) * 0.5);\n  const sustainability = clampScore(80 - toNumber(stats.weight) * 5 - toNumber(unit.price) * 0.001);\n  const mobility = clampScore(toNumber(stats.speed) * 6 + toNumber(caps?.sprint?.speed) * 2);\n  const versatility = clampScore(guns.length * 6);\n  const stealth = clampScore(toNumber(stats.stealth));\n  const speed = clampScore(toNumber(stats.speed) * 10);\n  const morale = clampScore(50 + toNumber(stats.health) * 0.2 + toNumber(unit.tier) * 4);\n  const training = clampScore(toNumber(unit.tier) * 10);\n  const antiInfantry = clampScore(toNumber(gren.frag) * 6);\n  const antiTank = clampScore(guns.reduce((sum, g) => sum + (g.category?.includes(\"Launcher\") ? 15 : 0), 0));\n  const antiAir = clampScore(guns.reduce((sum, g) => sum + (g.category?.includes(\"AA\") ? 20 : 0), 0));\n\n  return {\n    metrics: {\n      lethality,\n      survivability,\n      sustainability,\n      mobility,\n      versatility,\n      stealth,\n      speed,\n      morale,\n      training,\n      antiInfantry,\n      antiTank,\n      antiAir,\n    },\n  };\n};\n\nexport const scoreFormationDetailed = (\n  formation: Formation | undefined,\n  units: Unit[]\n): { metrics: Record<string, number> } | null => {\n  if (!formation) return null;\n  const unitIds = new Set<number>();\n  (formation.categories || []).forEach((cat) => (cat.units || []).forEach((id) => unitIds.add(id)));\n  if (!unitIds.size) return null;\n  const metricsArray = Array.from(unitIds)\n    .map((id) => scoreUnitDetailed(units[id]))\n    .filter(Boolean) as { metrics: Record<string, number> }[];\n  if (!metricsArray.length) return null;\n  const avg = (field: string) =>\n    metricsArray.reduce((sum, m) => sum + (m.metrics[field] || 0), 0) / metricsArray.length;\n  return {\n    metrics: {\n      recon: clampScore(avg(\"stealth\") + avg(\"speed\") * 0.5),\n      support: clampScore(avg(\"sustainability\") + avg(\"versatility\") * 0.5),\n      armor: clampScore(avg(\"survivability\")),\n      infantry: clampScore(avg(\"lethality\")),\n      logistics: clampScore(avg(\"sustainability\")),\n      air: clampScore(avg(\"antiAir\")),\n      sustaiment: clampScore(avg(\"sustainability\")),\n      speed: clampScore(avg(\"speed\")),\n      supplyEfficiency: clampScore(90 - avg(\"mobility\") * 0.3 + avg(\"sustainability\") * 0.2),\n      aoSize: clampScore(unitIds.size * 5),\n      versatility: clampScore(avg(\"versatility\")),\n    },\n  };\n};\n\nexport const scoreNationDetailed = (\n  nation: Nation | undefined,\n  formations: Formation[],\n  units: Unit[]\n): { metrics: Record<string, number> } | null => {\n  if (!nation) return null;\n  const formationIds = nation.formations || [];\n  if (!formationIds.length) return null;\n  const metricsArray = formationIds\n    .map((fid) => scoreFormationDetailed(formations[fid], units))\n    .filter(Boolean) as { metrics: Record<string, number> }[];\n  if (!metricsArray.length) return null;\n  const avg = (field: string) =>\n    metricsArray.reduce((sum, m) => sum + (m.metrics[field] || 0), 0) / metricsArray.length;\n  return {\n    metrics: {\n      strategicMomentum: clampScore(avg(\"versatility\") + avg(\"speed\") * 0.5 + avg(\"armor\") * 0.3),\n      supplyEfficiency: clampScore(avg(\"supplyEfficiency\") + avg(\"logistics\") * 0.5),\n      aoSize: clampScore(metricsArray.length * 10),\n      maneuverSpeed: clampScore(avg(\"speed\")),\n    },\n  };\n};\n","import type { Unit } from \"../types\";\nimport { hostBridge } from \"../lib/hostBridge\";\n\ntype UnitsEnvelope = {\n  units?: Unit[];\n};\n\nclass UnitService {\n  private units: Unit[] = [];\n  private subscribers = new Set<(units: Unit[]) => void>();\n\n  constructor() {\n    hostBridge.on<UnitsEnvelope>(\"units-data\", (payload) => {\n      this.units = Array.isArray(payload?.units) ? payload.units : [];\n      this.publish();\n    });\n  }\n\n  async loadUnits(): Promise<Unit[]> {\n    if (!hostBridge.isAvailable) {\n      console.warn(\"[UnitService] Host is unavailable; returning cached units only.\");\n      return this.units;\n    }\n    const payload = await hostBridge.request<undefined, UnitsEnvelope>(\"get-units\", undefined, \"units-data\");\n    this.units = Array.isArray(payload?.units) ? payload.units : [];\n    this.publish();\n    return this.units;\n  }\n\n  async saveUnit(unit: Unit): Promise<void> {\n    if (!hostBridge.isAvailable) {\n      throw new Error(\"Host is unavailable, cannot persist unit.\");\n    }\n    await hostBridge.request<{ unit: Unit }, UnitsEnvelope>(\"save-unit\", { unit }, \"units-data\");\n  }\n\n  async deleteUnit(id: number): Promise<void> {\n    if (!hostBridge.isAvailable) {\n      throw new Error(\"Host is unavailable, cannot delete unit.\");\n    }\n    await hostBridge.request<{ id: number }, UnitsEnvelope>(\"delete-unit\", { id }, \"units-data\");\n  }\n\n  getUnits(): Unit[] {\n    return this.units;\n  }\n\n  subscribe(callback: (units: Unit[]) => void): () => void {\n    this.subscribers.add(callback);\n    callback(this.units.map((unit) => ({ ...unit })));\n    return () => this.subscribers.delete(callback);\n  }\n\n  private publish(): void {\n    const snapshot = this.units.map((unit) => ({ ...unit }));\n    this.subscribers.forEach((subscriber) => subscriber(snapshot));\n  }\n}\n\nexport const unitService = new UnitService();\n","import type { Formation } from \"../types\";\nimport { hostBridge } from \"../lib/hostBridge\";\n\ntype FormationEnvelope = {\n  formations?: Formation[];\n};\n\nclass FormationService {\n  private formations: Formation[] = [];\n  private subscribers = new Set<(formations: Formation[]) => void>();\n\n  constructor() {\n    hostBridge.on<FormationEnvelope>(\"formations-data\", (payload) => {\n      const next = payload && Array.isArray(payload.formations) ? payload.formations : [];\n      this.formations = next;\n      this.publish();\n    });\n  }\n\n  async loadFormations(): Promise<Formation[]> {\n    if (!hostBridge.isAvailable) {\n      return this.formations;\n    }\n    const payload = await hostBridge.request<undefined, FormationEnvelope>(\"get-formations\", undefined, \"formations-data\");\n    this.formations = payload && Array.isArray(payload.formations) ? payload.formations : [];\n    this.publish();\n    return this.formations;\n  }\n\n  async saveFormations(formations: Formation[]): Promise<void> {\n    if (!hostBridge.isAvailable) {\n      throw new Error(\"Host is unavailable, cannot persist formations.\");\n    }\n    await hostBridge.request<{ formations: Formation[] }, FormationEnvelope>(\n      \"save-formations\",\n      { formations },\n      \"formations-data\"\n    );\n  }\n\n  getFormations(): Formation[] {\n    return this.formations;\n  }\n\n  subscribe(callback: (formations: Formation[]) => void): () => void {\n    this.subscribers.add(callback);\n    callback(this.formations.map((formation) => ({ ...formation })));\n    return () => this.subscribers.delete(callback);\n  }\n\n  private publish(): void {\n    const snapshot = this.formations.map((formation) => ({ ...formation }));\n    this.subscribers.forEach((subscriber) => subscriber(snapshot));\n  }\n}\n\nexport const formationService = new FormationService();\n","import type { Nation } from \"../types\";\nimport { hostBridge } from \"../lib/hostBridge\";\n\ntype NationEnvelope = {\n  nations?: Nation[];\n};\n\nclass NationService {\n  private nations: Nation[] = [];\n  private subscribers = new Set<(nations: Nation[]) => void>();\n\n  constructor() {\n    hostBridge.on<NationEnvelope>(\"nations-data\", (payload) => {\n      const next = payload && Array.isArray(payload.nations) ? payload.nations : [];\n      this.nations = next;\n      this.publish();\n    });\n  }\n\n  async loadNations(): Promise<Nation[]> {\n    if (!hostBridge.isAvailable) {\n      return this.nations;\n    }\n    const payload = await hostBridge.request<undefined, NationEnvelope>(\"get-nations\", undefined, \"nations-data\");\n    this.nations = payload && Array.isArray(payload.nations) ? payload.nations : [];\n    this.publish();\n    return this.nations;\n  }\n\n  async saveNations(nations: Nation[]): Promise<void> {\n    if (!hostBridge.isAvailable) {\n      throw new Error(\"Host is unavailable, cannot persist nations.\");\n    }\n    await hostBridge.request<{ nations: Nation[] }, NationEnvelope>(\n      \"save-nations\",\n      { nations },\n      \"nations-data\"\n    );\n  }\n\n  getNations(): Nation[] {\n    return this.nations;\n  }\n\n  subscribe(callback: (nations: Nation[]) => void): () => void {\n    this.subscribers.add(callback);\n    callback(this.nations.map((nation) => ({ ...nation })));\n    return () => this.subscribers.delete(callback);\n  }\n\n  private publish(): void {\n    const snapshot = this.nations.map((nation) => ({ ...nation }));\n    this.subscribers.forEach((subscriber) => subscriber(snapshot));\n  }\n}\n\nexport const nationService = new NationService();\n","import type { AppSettings } from \"../types\";\nimport { hostBridge } from \"../lib/hostBridge\";\n\nclass SettingsService {\n  private settings: AppSettings = {};\n  private subscribers = new Set<(settings: AppSettings) => void>();\n\n  constructor() {\n    hostBridge.on<AppSettings | undefined>(\"settings-data\", (payload) => {\n      this.settings = payload ? { ...payload } : {};\n      this.publish();\n    });\n  }\n\n  async loadSettings(): Promise<AppSettings> {\n    if (!hostBridge.isAvailable) {\n      return this.getSettings();\n    }\n    const payload = await hostBridge.request<undefined, AppSettings | undefined>(\n      \"get-settings\",\n      undefined,\n      \"settings-data\"\n    );\n    this.settings = payload ? { ...payload } : {};\n    this.publish();\n    return this.getSettings();\n  }\n\n  async saveSettings(settings: AppSettings): Promise<void> {\n    if (!hostBridge.isAvailable) {\n      throw new Error(\"Host is unavailable, cannot persist settings.\");\n    }\n    await hostBridge.request<AppSettings, AppSettings | undefined>(\"save-settings\", settings, \"settings-data\");\n  }\n\n  getSettings(): AppSettings {\n    return { ...this.settings };\n  }\n\n  subscribe(callback: (settings: AppSettings) => void): () => void {\n    this.subscribers.add(callback);\n    callback(this.getSettings());\n    return () => this.subscribers.delete(callback);\n  }\n\n  private publish(): void {\n    const snapshot = this.getSettings();\n    this.subscribers.forEach((subscriber) => subscriber(snapshot));\n  }\n}\n\nexport const settingsService = new SettingsService();\n","import type { Equipment, Gun, GunAmmo, GunFireMode, Unit, UnitGrenades, UnitStats } from \"../types\";\nimport { deepClone } from \"../lib/helpers\";\nimport { unitService } from \"../services/unitService\";\nimport { formationService } from \"../services/formationService\";\nimport { nationService } from \"../services/nationService\";\nimport { settingsService } from \"../services/settingsService\";\n\nconst createBlankUnit = (): Unit => ({\n  name: \"\",\n  category: \"\",\n  internalCategory: \"\",\n  tier: \"\",\n  price: \"\",\n  description: \"\",\n  image: \"\",\n  stats: {},\n  grenades: {},\n  capabilities: { sprint: {} },\n  guns: [],\n  equipment: [],\n});\n\nconst booleanToSelectValue = (value: boolean | string | undefined): string => {\n  if (value === true || value === \"true\") return \"true\";\n  if (value === false || value === \"false\") return \"false\";\n  return \"\";\n};\n\nconst parseBool = (value: FormDataEntryValue | null): boolean | undefined => {\n  if (!value) return undefined;\n  if (value.toString() === \"true\") return true;\n  if (value.toString() === \"false\") return false;\n  return undefined;\n};\n\nexport class UnitEditor {\n  private root: HTMLElement;\n  private units: Unit[] = [];\n\n  private form!: HTMLFormElement;\n  private unitListEl!: HTMLElement;\n  private gunListEl!: HTMLElement;\n  private equipmentListEl!: HTMLElement;\n  private statusEl!: HTMLElement;\n  private summaryEl!: HTMLElement;\n  private searchInput!: HTMLInputElement;\n  private categoryFilter!: HTMLSelectElement;\n  private sortModeSelect!: HTMLSelectElement;\n\n  private workingCopy: Unit = createBlankUnit();\n  private currentUnitId?: number;\n  private pendingName?: string;\n  private metaFormationsEl: HTMLElement | null = null;\n  private metaNationsEl: HTMLElement | null = null;\n  private metaThemeEl: HTMLElement | null = null;\n  private ammoTemplates: GunAmmo[] = [];\n  private fireTemplates: GunFireMode[] = [];\n  private ammoLibraryByCaliber = new Map<string, GunAmmo[]>();\n\n  constructor(root: HTMLElement) {\n    this.root = root;\n  }\n\n  async init(): Promise<void> {\n    this.renderLayout();\n    this.cacheElements();\n    this.bindEvents();\n    this.bindMetaFeeds();\n\n    unitService.subscribe((units) => {\n      this.units = units;\n      this.updateTemplateLibraries(units);\n      this.renderUnitList();\n      this.syncSelection();\n    });\n\n    await unitService.loadUnits().catch((error) => {\n      const message = error instanceof Error ? error.message : String(error);\n      this.setStatus(`Failed to load units: ${message}`, \"error\");\n    });\n\n    if (!this.units.length) {\n      this.startNewUnit();\n    }\n  }\n\n  private renderLayout(): void {\n    this.root.innerHTML = `\n      <div class=\"workspace\">\n        <aside class=\"sidebar\">\n          <header class=\"sidebar-header\">\n            <div>\n              <p class=\"eyebrow\">SQLite source</p>\n              <h1>Unit Browser</h1>\n              <p class=\"muted\">Select an existing unit or start a fresh draft.</p>\n            </div>\n            <button type=\"button\" class=\"ghost\" data-action=\"refresh-units\">Refresh</button>\n          </header>\n          <div class=\"sidebar-actions\">\n            <input type=\"search\" placeholder=\"Search name or category\" data-role=\"search\" />\n            <button type=\"button\" class=\"primary\" data-action=\"new-unit\">+ New unit</button>\n          </div>\n          <div class=\"sidebar-actions\">\n            <select data-role=\"category-filter\">\n              <option value=\"\">All categories</option>\n              <option value=\"INF\">Infantry</option>\n              <option value=\"ARM\">Armor</option>\n              <option value=\"LOG\">Logistics</option>\n              <option value=\"AIR\">Air</option>\n            </select>\n            <select data-role=\"sort-mode\">\n              <option value=\"name-asc\">Name A â†’ Z</option>\n              <option value=\"name-desc\">Name Z â†’ A</option>\n              <option value=\"price-asc\">Price low â†’ high</option>\n              <option value=\"price-desc\">Price high â†’ low</option>\n            </select>\n          </div>\n          <div class=\"unit-list\" data-role=\"unit-list\"></div>\n        </aside>\n        <section class=\"editor\">\n          <header class=\"editor-header\">\n            <div>\n              <p class=\"eyebrow\">Unit Editor</p>\n              <h2>Combat Design Suite</h2>\n              <p class=\"muted\" data-role=\"unit-summary\">Select a unit to begin.</p>\n            </div>\n            <div class=\"editor-actions\">\n              <button type=\"button\" class=\"ghost\" data-action=\"reset-unit\">Reset</button>\n              <button type=\"button\" class=\"ghost danger\" data-action=\"delete-unit\">Delete</button>\n              <button type=\"submit\" class=\"primary\" form=\"unitForm\">Save unit</button>\n            </div>\n          </header>\n          <form id=\"unitForm\" data-role=\"unit-form\" class=\"editor-form\">\n            <input type=\"hidden\" name=\"unit-id\" />\n            <section class=\"panel grid-3\">\n              <div class=\"field\">\n                <label>Name</label>\n                <input name=\"name\" autocomplete=\"off\" />\n              </div>\n              <div class=\"field\">\n                <label>Category</label>\n                <input name=\"category\" placeholder=\"INF, ARM, LOG\" />\n              </div>\n              <div class=\"field\">\n                <label>Internal category</label>\n                <input name=\"internalCategory\" />\n              </div>\n              <div class=\"field\">\n                <label>Tier</label>\n                <input name=\"tier\" placeholder=\"Elite, Regular ...\" />\n              </div>\n              <div class=\"field\">\n                <label>Price</label>\n                <input name=\"price\" type=\"number\" step=\"1\" min=\"0\" />\n              </div>\n              <div class=\"field\">\n                <label>Image</label>\n                <input name=\"image\" placeholder=\"assets/units/pathfinder.png\" />\n              </div>\n            </section>\n            <section class=\"panel\">\n              <label>Description</label>\n              <textarea name=\"description\" rows=\"4\" placeholder=\"Overview, strengths, doctrine...\"></textarea>\n            </section>\n            <section class=\"panel\">\n              <div class=\"panel-title\">Core stats</div>\n              <div class=\"core-stats-grid\">\n                <div class=\"field\"><label>Armor (mm)</label><input name=\"stats.armor\" type=\"number\" step=\"0.1\" /></div>\n                <div class=\"field\"><label>Health (HP)</label><input name=\"stats.health\" type=\"number\" step=\"0.1\" /></div>\n                <div class=\"field\"><label>Squad size (#)</label><input name=\"stats.squadSize\" type=\"number\" step=\"1\" min=\"0\" /></div>\n                <div class=\"field\"><label>Visual range (m)</label><input name=\"stats.visualRange\" type=\"number\" step=\"1\" min=\"0\" /></div>\n                <div class=\"field\"><label>Stealth (%)</label><input name=\"stats.stealth\" type=\"number\" step=\"1\" min=\"0\" /></div>\n                <div class=\"field\"><label>Speed (m/s)</label><input name=\"stats.speed\" type=\"number\" step=\"0.1\" /></div>\n                <div class=\"field\"><label>Weight (kg)</label><input name=\"stats.weight\" type=\"number\" step=\"0.1\" /></div>\n              </div>\n            </section>\n            <section class=\"panel grid-4\">\n              <div class=\"panel-title\">Capabilities</div>\n              <div class=\"field\">\n                <label>Static line jump</label>\n                <select name=\"cap.staticLineJump\">\n                  <option value=\"\">Unknown</option>\n                  <option value=\"true\">Yes</option>\n                  <option value=\"false\">No</option>\n                </select>\n              </div>\n              <div class=\"field\">\n                <label>HALO/HAHO</label>\n                <select name=\"cap.haloHaho\">\n                  <option value=\"\">Unknown</option>\n                  <option value=\"true\">Yes</option>\n                  <option value=\"false\">No</option>\n                </select>\n              </div>\n              <div class=\"field\">\n                <label>Laser designator</label>\n                <select name=\"cap.laserDesignator\">\n                  <option value=\"\">Unknown</option>\n                  <option value=\"true\">Yes</option>\n                  <option value=\"false\">No</option>\n                </select>\n              </div>\n              <div class=\"field\">\n                <label>Sprint distance (m)</label>\n                <input name=\"cap.sprint.distance\" type=\"number\" step=\"1\" min=\"0\" />\n              </div>\n              <div class=\"field\">\n                <label>Sprint speed (m/s)</label>\n                <input name=\"cap.sprint.speed\" type=\"number\" step=\"0.1\" />\n              </div>\n              <div class=\"field\">\n                <label>Sprint cooldown (s)</label>\n                <input name=\"cap.sprint.cooldown\" type=\"number\" step=\"0.1\" min=\"0\" />\n              </div>\n            </section>\n            <section class=\"panel grid-5\">\n              <div class=\"panel-title\">Grenades</div>\n              <div class=\"field\"><label>Smoke</label><input name=\"grenades.smoke\" type=\"number\" step=\"1\" min=\"0\" /></div>\n              <div class=\"field\"><label>Flash</label><input name=\"grenades.flash\" type=\"number\" step=\"1\" min=\"0\" /></div>\n              <div class=\"field\"><label>Thermite</label><input name=\"grenades.thermite\" type=\"number\" step=\"1\" min=\"0\" /></div>\n              <div class=\"field\"><label>Frag</label><input name=\"grenades.frag\" type=\"number\" step=\"1\" min=\"0\" /></div>\n              <div class=\"field\"><label>Total</label><input name=\"grenades.total\" type=\"number\" step=\"1\" min=\"0\" /></div>\n            </section>\n            <section class=\"panel\">\n              <div class=\"panel-heading\">\n                <h3>Weapons</h3>\n                <button type=\"button\" class=\"ghost\" data-action=\"add-gun\">Add weapon</button>\n              </div>\n              <div class=\"repeatable-list\" data-role=\"gun-list\">\n                <p class=\"empty\">No weapons configured.</p>\n              </div>\n            </section>\n            <section class=\"panel\">\n              <div class=\"panel-heading\">\n                <h3>Equipment</h3>\n                <button type=\"button\" class=\"ghost\" data-action=\"add-equipment\">Add equipment</button>\n              </div>\n              <div class=\"repeatable-list\" data-role=\"equipment-list\">\n                <p class=\"empty\">No equipment entries yet.</p>\n              </div>\n            </section>\n          </form>\n          <div class=\"status-bar\" data-role=\"status-bar\">Ready.</div>\n          <div class=\"meta-bar\" data-role=\"meta-bar\">\n            <span>Formations: <strong data-role=\"meta-formations\">0</strong></span>\n            <span>Nations: <strong data-role=\"meta-nations\">0</strong></span>\n            <span>Theme: <strong data-role=\"meta-theme\">System</strong></span>\n          </div>\n        </section>\n      </div>\n    `;\n  }\n\n  private cacheElements(): void {\n    this.form = this.root.querySelector<HTMLFormElement>('[data-role=\"unit-form\"]')!;\n    this.unitListEl = this.root.querySelector<HTMLElement>('[data-role=\"unit-list\"]')!;\n    this.gunListEl = this.root.querySelector<HTMLElement>('[data-role=\"gun-list\"]')!;\n    this.equipmentListEl = this.root.querySelector<HTMLElement>('[data-role=\"equipment-list\"]')!;\n    this.statusEl = this.root.querySelector<HTMLElement>('[data-role=\"status-bar\"]')!;\n    this.summaryEl = this.root.querySelector<HTMLElement>('[data-role=\"unit-summary\"]')!;\n    this.searchInput = this.root.querySelector<HTMLInputElement>('[data-role=\"search\"]')!;\n    this.categoryFilter = this.root.querySelector<HTMLSelectElement>('[data-role=\"category-filter\"]')!;\n    this.sortModeSelect = this.root.querySelector<HTMLSelectElement>('[data-role=\"sort-mode\"]')!;\n    this.metaFormationsEl = this.root.querySelector<HTMLElement>('[data-role=\"meta-formations\"]');\n    this.metaNationsEl = this.root.querySelector<HTMLElement>('[data-role=\"meta-nations\"]');\n    this.metaThemeEl = this.root.querySelector<HTMLElement>('[data-role=\"meta-theme\"]');\n  }\n\n  private bindEvents(): void {\n    this.unitListEl.addEventListener(\"click\", (event) => this.handleUnitListClick(event));\n    this.form.addEventListener(\"submit\", (event) => this.handleSubmit(event));\n    this.root.addEventListener(\"click\", (event) => this.handleAction(event));\n    this.searchInput.addEventListener(\"input\", () => {\n      this.renderUnitList();\n    });\n    this.categoryFilter.addEventListener(\"change\", () => this.renderUnitList());\n    this.sortModeSelect.addEventListener(\"change\", () => this.renderUnitList());\n  }\n\n  private bindMetaFeeds(): void {\n    formationService.subscribe((formations) => {\n      if (this.metaFormationsEl) this.metaFormationsEl.textContent = formations.length.toString();\n    });\n    nationService.subscribe((nations) => {\n      if (this.metaNationsEl) this.metaNationsEl.textContent = nations.length.toString();\n    });\n    settingsService.subscribe((settings) => {\n      if (this.metaThemeEl) this.metaThemeEl.textContent = settings.theme || \"System\";\n    });\n\n    formationService.loadFormations().catch((error) => {\n      console.error(\"Failed to load formations\", error);\n    });\n    nationService.loadNations().catch((error) => {\n      console.error(\"Failed to load nations\", error);\n    });\n    settingsService.loadSettings().catch((error) => {\n      console.error(\"Failed to load settings\", error);\n    });\n  }\n\n  private handleUnitListClick(event: Event): void {\n    const button = (event.target as HTMLElement).closest<HTMLButtonElement>(\".unit-pill\");\n    if (!button) return;\n    const index = Number(button.dataset.index);\n    const unit = this.units[index];\n    if (unit) {\n      this.loadUnit(unit);\n    }\n  }\n\n  private async handleSubmit(event: SubmitEvent): Promise<void> {\n    event.preventDefault();\n    const unit = this.collectFormData();\n    if (!unit.name) {\n      this.setStatus(\"Name is required.\", \"error\");\n      return;\n    }\n\n    try {\n      if (!unit.id) {\n        this.pendingName = unit.name.toLowerCase();\n      } else {\n        this.currentUnitId = unit.id;\n      }\n      this.setStatus(\"Saving unit...\", \"default\");\n      await unitService.saveUnit(unit);\n      this.setStatus(\"Unit saved.\", \"success\");\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      this.setStatus(`Failed to save unit: ${message}`, \"error\");\n    }\n  }\n\n  private handleAction(event: MouseEvent): void {\n    const button = (event.target as HTMLElement).closest<HTMLButtonElement>(\"[data-action]\");\n    if (!button) return;\n    const action = button.dataset.action;\n    if (!action) return;\n    event.preventDefault();\n\n    switch (action) {\n      case \"refresh-units\":\n        this.setStatus(\"Refreshing from host...\", \"default\");\n        unitService.loadUnits().catch((error) => {\n          const message = error instanceof Error ? error.message : String(error);\n          this.setStatus(`Refresh failed: ${message}`, \"error\");\n        });\n        break;\n      case \"new-unit\":\n        this.startNewUnit();\n        break;\n      case \"reset-unit\":\n        this.resetCurrentUnit();\n        break;\n      case \"add-gun\":\n        this.appendGunRow();\n        break;\n      case \"add-equipment\":\n        this.appendEquipmentRow();\n        break;\n      case \"delete-unit\":\n        this.deleteCurrentUnit();\n        break;\n      case \"remove-gun\": {\n        const row = button.closest(\".repeatable-row\");\n        row?.remove();\n        if (!this.gunListEl.querySelector(\".repeatable-row\")) {\n          this.gunListEl.innerHTML = '<p class=\"empty\">No weapons configured.</p>';\n        }\n        break;\n      }\n      case \"remove-equipment\": {\n        const row = button.closest(\".repeatable-row\");\n        row?.remove();\n        if (!this.equipmentListEl.querySelector(\".repeatable-row\")) {\n          this.equipmentListEl.innerHTML = '<p class=\"empty\">No equipment entries yet.</p>';\n        }\n        break;\n      }\n      default:\n        break;\n    }\n  }\n\n  private async deleteCurrentUnit(): Promise<void> {\n    if (!this.currentUnitId) {\n      this.setStatus(\"Select a saved unit before deleting.\", \"error\");\n      return;\n    }\n    const confirmed = window.confirm(\"Delete this unit permanently?\");\n    if (!confirmed) return;\n    try {\n      this.setStatus(\"Deleting unit...\", \"default\");\n      await unitService.deleteUnit(this.currentUnitId);\n      this.currentUnitId = undefined;\n      this.startNewUnit();\n      this.setStatus(\"Unit removed.\", \"success\");\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      this.setStatus(`Failed to delete unit: ${message}`, \"error\");\n    }\n  }\n\n  private renderUnitList(): void {\n    if (!this.unitListEl) return;\n    this.unitListEl.innerHTML = \"\";\n    const search = this.searchInput.value.trim().toLowerCase();\n    const categoryFilter = this.categoryFilter.value;\n    const items = this.units\n      .map((unit, index) => ({ unit, index }))\n      .filter(({ unit }) => {\n        if (!search) return true;\n        const haystack = `${unit.name ?? \"\"} ${unit.category ?? \"\"}`.toLowerCase();\n        return haystack.includes(search);\n      })\n      .filter(({ unit }) => {\n        if (!categoryFilter) return true;\n        return (unit.category || \"\").toUpperCase() === categoryFilter;\n      });\n\n    const sortMode = this.sortModeSelect.value;\n    items.sort((a, b) => {\n      switch (sortMode) {\n        case \"name-desc\":\n          return (b.unit.name || \"\").localeCompare(a.unit.name || \"\");\n        case \"price-asc\":\n          return (Number(a.unit.price) || 0) - (Number(b.unit.price) || 0);\n        case \"price-desc\":\n          return (Number(b.unit.price) || 0) - (Number(a.unit.price) || 0);\n        case \"name-asc\":\n        default:\n          return (a.unit.name || \"\").localeCompare(b.unit.name || \"\");\n      }\n    });\n\n    if (!items.length) {\n      this.unitListEl.innerHTML = '<p class=\"empty\">No units match the current search.</p>';\n      return;\n    }\n\n    items.forEach(({ unit, index }) => {\n      const btn = document.createElement(\"button\");\n      btn.type = \"button\";\n      btn.className = \"unit-pill\";\n      btn.dataset.index = index.toString();\n      if (this.currentUnitId && unit.id === this.currentUnitId) {\n        btn.classList.add(\"active\");\n      }\n      btn.innerHTML = `\n        <span class=\"title\">${unit.name || \"Unnamed unit\"}</span>\n        <span class=\"meta\">${unit.category || \"?\"} Â· ${unit.tier || \"Tier ?\"} Â· ${unit.price ?? \"â€”\"} pts</span>\n      `;\n      this.unitListEl.appendChild(btn);\n    });\n  }\n\n  private loadUnit(unit: Unit): void {\n    this.workingCopy = deepClone(unit);\n    this.currentUnitId = typeof unit.id === \"number\" ? unit.id : undefined;\n    this.pendingName = undefined;\n    this.populateForm(this.workingCopy);\n    this.setSummary(this.workingCopy.name ? `Editing ${this.workingCopy.name}` : \"Editing unit\");\n    this.renderUnitList();\n    this.setStatus(\"Unit loaded.\", \"default\");\n  }\n\n  private startNewUnit(): void {\n    this.workingCopy = createBlankUnit();\n    this.currentUnitId = undefined;\n    this.pendingName = undefined;\n    this.populateForm(this.workingCopy);\n    this.setSummary(\"New unit draft\");\n    this.renderUnitList();\n    this.setStatus(\"Ready to capture a new unit.\", \"default\");\n  }\n\n  private resetCurrentUnit(): void {\n    if (this.currentUnitId) {\n      const match = this.units.find((u) => u.id === this.currentUnitId);\n      if (match) {\n        this.loadUnit(match);\n        return;\n      }\n    }\n    this.startNewUnit();\n  }\n\n  private populateForm(unit: Unit): void {\n    const setValue = (name: string, value: unknown) => {\n      const field = this.form.querySelector<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>(\n        `[name=\"${name}\"]`\n      );\n      if (!field) return;\n      field.value = value === undefined || value === null ? \"\" : String(value);\n    };\n\n    setValue(\"unit-id\", unit.id);\n    setValue(\"name\", unit.name ?? \"\");\n    setValue(\"category\", unit.category ?? \"\");\n    setValue(\"internalCategory\", unit.internalCategory ?? \"\");\n    setValue(\"tier\", unit.tier ?? \"\");\n    setValue(\"price\", unit.price ?? \"\");\n    setValue(\"image\", unit.image ?? \"\");\n    setValue(\"description\", unit.description ?? \"\");\n\n    const stats = unit.stats ?? {};\n    setValue(\"stats.armor\", stats.armor ?? \"\");\n    setValue(\"stats.health\", stats.health ?? \"\");\n    setValue(\"stats.squadSize\", stats.squadSize ?? \"\");\n    setValue(\"stats.visualRange\", stats.visualRange ?? \"\");\n    setValue(\"stats.stealth\", stats.stealth ?? \"\");\n    setValue(\"stats.speed\", stats.speed ?? \"\");\n    setValue(\"stats.weight\", stats.weight ?? \"\");\n\n    const caps = unit.capabilities ?? {};\n    setValue(\"cap.staticLineJump\", booleanToSelectValue(caps.staticLineJump));\n    setValue(\"cap.haloHaho\", booleanToSelectValue(caps.haloHaho));\n    setValue(\"cap.laserDesignator\", booleanToSelectValue(caps.laserDesignator));\n    setValue(\"cap.sprint.distance\", caps.sprint?.distance ?? \"\");\n    setValue(\"cap.sprint.speed\", caps.sprint?.speed ?? \"\");\n    setValue(\"cap.sprint.cooldown\", caps.sprint?.cooldown ?? \"\");\n\n    const gren = unit.grenades ?? {};\n    setValue(\"grenades.smoke\", gren.smoke ?? \"\");\n    setValue(\"grenades.flash\", gren.flash ?? \"\");\n    setValue(\"grenades.thermite\", gren.thermite ?? \"\");\n    setValue(\"grenades.frag\", gren.frag ?? \"\");\n    setValue(\"grenades.total\", gren.total ?? \"\");\n\n    this.renderGunList(unit.guns ?? []);\n    this.renderEquipmentList(unit.equipment ?? []);\n  }\n\n  private renderGunList(guns: Gun[]): void {\n    if (!this.gunListEl) return;\n    if (!guns.length) {\n      this.gunListEl.innerHTML = '<p class=\"empty\">No weapons configured.</p>';\n      return;\n    }\n    this.gunListEl.innerHTML = \"\";\n    guns.forEach((gun) => this.appendGunRow(gun));\n  }\n\n  private renderEquipmentList(items: Equipment[]): void {\n    if (!this.equipmentListEl) return;\n    if (!items.length) {\n      this.equipmentListEl.innerHTML = '<p class=\"empty\">No equipment entries yet.</p>';\n      return;\n    }\n    this.equipmentListEl.innerHTML = \"\";\n    items.forEach((equipment) => this.appendEquipmentRow(equipment));\n  }\n\n  private appendGunRow(gun?: Gun): void {\n    if (!this.gunListEl) return;\n    if (this.gunListEl.querySelector(\".empty\")) {\n      this.gunListEl.innerHTML = \"\";\n    }\n    const row = document.createElement(\"div\");\n    row.className = \"repeatable-row\";\n    row.innerHTML = `\n      <div class=\"row-header\">\n        <strong data-role=\"row-title\">${gun?.name || \"New weapon\"}</strong>\n        <button type=\"button\" class=\"ghost\" data-action=\"remove-gun\">Remove</button>\n      </div>\n      <div class=\"repeatable-grid\">\n        <label>Name<input data-field=\"name\" value=\"${gun?.name ?? \"\"}\" /></label>\n        <label>Category<input data-field=\"category\" value=\"${gun?.category ?? \"\"}\" /></label>\n        <label>Caliber<input data-field=\"caliber\" value=\"${gun?.caliber ?? \"\"}\" /></label>\n        <label>Barrel length<input data-field=\"barrelLength\" type=\"number\" step=\"0.1\" value=\"${gun?.barrelLength ?? \"\"}\" /></label>\n          <label>Range (m)<input data-field=\"range\" type=\"number\" step=\"1\" value=\"${gun?.range ?? \"\"}\" /></label>\n          <label>Dispersion (%)<input data-field=\"dispersion\" type=\"number\" step=\"0.01\" value=\"${gun?.dispersion ?? \"\"}\" /></label>\n        <label>Count<input data-field=\"count\" type=\"number\" step=\"1\" min=\"0\" value=\"${gun?.count ?? \"\"}\" /></label>\n        <label>Ammo / soldier<input data-field=\"ammoPerSoldier\" type=\"number\" step=\"1\" min=\"0\" value=\"${gun?.ammoPerSoldier ?? \"\"}\" /></label>\n        <label>Total ammo<input data-field=\"totalAmmo\" type=\"number\" step=\"1\" min=\"0\" value=\"${gun?.totalAmmo ?? \"\"}\" /></label>\n        <label>Magazine size<input data-field=\"magazineSize\" type=\"number\" step=\"1\" min=\"0\" value=\"${gun?.magazineSize ?? \"\"}\" /></label>\n        <label>Reload speed<input data-field=\"reloadSpeed\" type=\"number\" step=\"0.1\" value=\"${gun?.reloadSpeed ?? \"\"}\" /></label>\n        <label>Target acquisition<input data-field=\"targetAcquisition\" type=\"number\" step=\"0.1\" value=\"${gun?.targetAcquisition ?? \"\"}\" /></label>\n      </div>\n    `;\n    const nameInput = row.querySelector<HTMLInputElement>('[data-field=\"name\"]');\n    const title = row.querySelector<HTMLSpanElement>('[data-role=\"row-title\"]');\n    nameInput?.addEventListener(\"input\", () => {\n      if (title) title.textContent = nameInput.value || \"New weapon\";\n    });\n\n    const ammoSection = document.createElement(\"div\");\n    ammoSection.className = \"subpanel\";\n    const ammoHeader = document.createElement(\"div\");\n    ammoHeader.className = \"subpanel-heading\";\n    ammoHeader.innerHTML = `<strong>Ammo types</strong>`;\n    const ammoActions = document.createElement(\"div\");\n    ammoActions.className = \"header-actions\";\n    const ammoLibrarySelect = document.createElement(\"select\");\n    ammoLibrarySelect.className = \"ghost small\";\n    const populateAmmoLibrary = () => {\n      ammoLibrarySelect.innerHTML = `<option value=\"\">From library...</option>`;\n      this.ammoTemplates.forEach((tpl, index) => {\n        const option = document.createElement(\"option\");\n        option.value = index.toString();\n        option.textContent = tpl.name || `Template ${index + 1}`;\n        ammoLibrarySelect.appendChild(option);\n      });\n    };\n    populateAmmoLibrary();\n    ammoLibrarySelect.addEventListener(\"focus\", populateAmmoLibrary);\n    ammoLibrarySelect.addEventListener(\"change\", () => {\n      if (!ammoLibrarySelect.value) return;\n      const template = this.ammoTemplates[Number(ammoLibrarySelect.value)];\n      if (template) {\n        appendAmmoRow(deepClone(template));\n        refreshFireAmmoOptions();\n      }\n      ammoLibrarySelect.value = \"\";\n    });\n    const addAmmoBtn = document.createElement(\"button\");\n    addAmmoBtn.type = \"button\";\n    addAmmoBtn.className = \"ghost small\";\n    addAmmoBtn.textContent = \"Add ammo\";\n    ammoActions.append(ammoLibrarySelect, addAmmoBtn);\n    ammoHeader.appendChild(ammoActions);\n    const ammoList = document.createElement(\"div\");\n    ammoList.className = \"subpanel-list ammo-list\";\n\n    const fireSection = document.createElement(\"div\");\n    fireSection.className = \"subpanel\";\n    const fireHeader = document.createElement(\"div\");\n    fireHeader.className = \"subpanel-heading\";\n    fireHeader.innerHTML = `<strong>Fire modes</strong>`;\n    const fireActions = document.createElement(\"div\");\n    fireActions.className = \"header-actions\";\n    const fireLibrarySelect = document.createElement(\"select\");\n    fireLibrarySelect.className = \"ghost small\";\n    const populateFireLibrary = () => {\n      fireLibrarySelect.innerHTML = `<option value=\"\">From library...</option>`;\n      this.fireTemplates.forEach((tpl, index) => {\n        const option = document.createElement(\"option\");\n        option.value = index.toString();\n        option.textContent = tpl.name || `Mode ${index + 1}`;\n        fireLibrarySelect.appendChild(option);\n      });\n    };\n    populateFireLibrary();\n    fireLibrarySelect.addEventListener(\"focus\", populateFireLibrary);\n    fireLibrarySelect.addEventListener(\"change\", () => {\n      if (!fireLibrarySelect.value) return;\n      const template = this.fireTemplates[Number(fireLibrarySelect.value)];\n      if (template) {\n        appendFireRow(deepClone(template));\n        refreshFireAmmoOptions();\n      }\n      fireLibrarySelect.value = \"\";\n    });\n    const addFireBtn = document.createElement(\"button\");\n    addFireBtn.type = \"button\";\n    addFireBtn.className = \"ghost small\";\n    addFireBtn.textContent = \"Add fire mode\";\n    fireActions.append(fireLibrarySelect, addFireBtn);\n    fireHeader.appendChild(fireActions);\n    const fireList = document.createElement(\"div\");\n    fireList.className = \"subpanel-list fire-list\";\n\n    const appendAmmoRow = (ammo?: GunAmmo) => {\n      const ammoRow = document.createElement(\"div\");\n      ammoRow.className = \"ammo-row\";\n      ammoRow.innerHTML = `\n        <div class=\"subgrid\">\n          <label>Name<input data-ammo-field=\"name\" value=\"${ammo?.name ?? \"\"}\" /></label>\n          <label>Type<input data-ammo-field=\"ammoType\" value=\"${ammo?.ammoType ?? \"\"}\" /></label>\n          <label>Caliber notes<input data-ammo-field=\"caliberDesc\" value=\"${ammo?.caliberDesc ?? \"\"}\" /></label>\n          <label>Penetration (mm)<input type=\"number\" step=\"0.1\" data-ammo-field=\"penetration\" value=\"${ammo?.penetration ?? \"\"}\" /></label>\n          <label>HE value<input type=\"number\" step=\"0.1\" data-ammo-field=\"heDeadliness\" value=\"${ammo?.heDeadliness ?? \"\"}\" /></label>\n          <label>Dispersion (%)<input type=\"number\" step=\"0.1\" data-ammo-field=\"dispersion\" value=\"${ammo?.dispersion ?? \"\"}\" /></label>\n          <label>Range delta (%)<input type=\"number\" step=\"0.1\" data-ammo-field=\"rangeMod\" value=\"${ammo?.rangeMod ?? \"\"}\" /></label>\n          <label>Ammo/Soldier (#)<input type=\"number\" step=\"1\" min=\"0\" data-ammo-field=\"ammoPerSoldier\" value=\"${ammo?.ammoPerSoldier ?? \"\"}\" /></label>\n          <label>Grain (gr)<input type=\"number\" step=\"0.1\" data-ammo-field=\"grain\" value=\"${ammo?.grain ?? \"\"}\" /></label>\n          <label>Muzzle velocity (fps)<input type=\"number\" step=\"1\" data-ammo-field=\"fps\" value=\"${ammo?.fps ?? \"\"}\" /></label>\n          <label>Notes<input data-ammo-field=\"notes\" value=\"${ammo?.notes ?? \"\"}\" /></label>\n          <label>Airburst\n            <select data-ammo-field=\"airburst\">\n              <option value=\"\" ${ammo?.airburst === undefined ? \"selected\" : \"\"}>None</option>\n              <option value=\"yes\" ${ammo?.airburst === true || ammo?.airburst === \"true\" ? \"selected\" : \"\"}>Yes</option>\n              <option value=\"no\" ${ammo?.airburst === false || ammo?.airburst === \"false\" ? \"selected\" : \"\"}>No</option>\n            </select>\n          </label>\n          <label>Sub munitions (#)<input type=\"number\" step=\"1\" min=\"0\" data-ammo-field=\"subCount\" value=\"${ammo?.subCount ?? \"\"}\" /></label>\n          <label>Sub damage<input type=\"number\" step=\"0.1\" data-ammo-field=\"subDamage\" value=\"${ammo?.subDamage ?? \"\"}\" /></label>\n          <label>Sub penetration (mm)<input type=\"number\" step=\"0.1\" data-ammo-field=\"subPenetration\" value=\"${ammo?.subPenetration ?? \"\"}\" /></label>\n        </div>\n        <div class=\"row-actions\">\n          <button type=\"button\" class=\"ghost small\" data-action=\"remove-ammo\">Remove ammo</button>\n        </div>\n      `;\n      ammoRow.querySelector<HTMLButtonElement>('[data-action=\"remove-ammo\"]')?.addEventListener(\"click\", () => {\n        ammoRow.remove();\n        refreshFireAmmoOptions();\n      });\n      ammoList.appendChild(ammoRow);\n      const grainInput = ammoRow.querySelector<HTMLInputElement>('input[data-ammo-field=\"grain\"]');\n      const fpsInput = ammoRow.querySelector<HTMLInputElement>('input[data-ammo-field=\"fps\"]');\n      const getBarrelLength = () =>\n        parseFloat(row.querySelector<HTMLInputElement>('[data-field=\"barrelLength\"]')?.value || \"0\") || 0;\n      const applyBallistics = () => {\n        if (!grainInput || !fpsInput) return;\n        const grain = parseFloat(grainInput.value || \"0\");\n        const barrel = getBarrelLength();\n        if (Number.isNaN(grain) || Number.isNaN(barrel)) return;\n        const velocity = Math.max(200, Math.round(700 + barrel * 30 - grain * 1.5));\n        fpsInput.value = velocity.toString();\n      };\n      grainInput?.addEventListener(\"input\", applyBallistics);\n      row.querySelector<HTMLInputElement>('[data-field=\"barrelLength\"]')?.addEventListener(\"input\", applyBallistics);\n    };\n\n    const appendFireRow = (mode?: GunFireMode) => {\n      const fireRow = document.createElement(\"div\");\n      fireRow.className = \"fire-row\";\n      fireRow.innerHTML = `\n        <div class=\"subgrid\">\n          <label>Name<input data-fire-field=\"name\" value=\"${mode?.name ?? \"\"}\" /></label>\n          <label>Rounds / burst (#)<input type=\"number\" step=\"1\" min=\"0\" data-fire-field=\"rounds\" value=\"${mode?.rounds ?? \"\"}\" /></label>\n          <label>Burst duration (s)<input type=\"number\" step=\"0.1\" min=\"0\" data-fire-field=\"burstDuration\" value=\"${mode?.burstDuration ?? \"\"}\" /></label>\n          <label>Cooldown (s)<input type=\"number\" step=\"0.1\" min=\"0\" data-fire-field=\"cooldown\" value=\"${mode?.cooldown ?? \"\"}\" /></label>\n          <label>Ammo reference<select data-fire-field=\"ammoRef\"></select></label>\n        </div>\n        <div class=\"row-actions\">\n          <button type=\"button\" class=\"ghost small\" data-action=\"remove-fire\">Remove mode</button>\n        </div>\n      `;\n      fireRow.querySelector<HTMLButtonElement>('[data-action=\"remove-fire\"]')?.addEventListener(\"click\", () => {\n        fireRow.remove();\n      });\n      fireList.appendChild(fireRow);\n    };\n\n    const getAmmoNames = () =>\n      Array.from(ammoList.querySelectorAll<HTMLInputElement>('input[data-ammo-field=\"name\"]'))\n        .map((input) => input.value.trim())\n        .filter(Boolean);\n\n    const refreshFireAmmoOptions = () => {\n      const names = getAmmoNames();\n      fireList.querySelectorAll<HTMLSelectElement>('select[data-fire-field=\"ammoRef\"]').forEach((select) => {\n        const current = select.value || select.dataset.prefill || \"\";\n        select.innerHTML = \"\";\n        const empty = document.createElement(\"option\");\n        empty.value = \"\";\n        empty.textContent = \"None\";\n        select.appendChild(empty);\n        names.forEach((name) => {\n          const opt = document.createElement(\"option\");\n          opt.value = name;\n          opt.textContent = name;\n          select.appendChild(opt);\n        });\n        if (names.includes(current)) {\n          select.value = current;\n        } else {\n          select.value = \"\";\n          if (current) select.dataset.prefill = current;\n        }\n      });\n    };\n\n    addAmmoBtn.addEventListener(\"click\", () => {\n      appendAmmoRow();\n      refreshFireAmmoOptions();\n    });\n    addFireBtn.addEventListener(\"click\", () => {\n      appendFireRow();\n      refreshFireAmmoOptions();\n    });\n\n    const ammoSource = Array.isArray(gun?.ammoTypes) && gun?.ammoTypes.length ? gun!.ammoTypes! : [undefined];\n    ammoSource.forEach((ammo) => appendAmmoRow(ammo));\n    const fireSource = Array.isArray(gun?.fireModes) && gun?.fireModes.length ? gun!.fireModes! : [undefined];\n    fireSource.forEach((mode) => appendFireRow(mode));\n\n    ammoList.addEventListener(\"input\", (event) => {\n      if ((event.target as HTMLElement).matches('[data-ammo-field=\"name\"]')) {\n        refreshFireAmmoOptions();\n      }\n    });\n\n    ammoSection.append(ammoHeader, ammoList);\n    fireSection.append(fireHeader, fireList);\n    row.append(fireSection, ammoSection);\n    this.gunListEl.appendChild(row);\n    refreshFireAmmoOptions();\n  }\n\n  private appendEquipmentRow(item?: Equipment): void {\n    if (!this.equipmentListEl) return;\n    if (this.equipmentListEl.querySelector(\".empty\")) {\n      this.equipmentListEl.innerHTML = \"\";\n    }\n    const row = document.createElement(\"div\");\n    row.className = \"repeatable-row\";\n    row.innerHTML = `\n      <div class=\"row-header\">\n        <strong data-role=\"row-title\">${item?.name || \"New equipment\"}</strong>\n        <button type=\"button\" class=\"ghost\" data-action=\"remove-equipment\">Remove</button>\n      </div>\n      <div class=\"repeatable-grid\">\n        <label>Name<input data-field=\"name\" value=\"${item?.name ?? \"\"}\" /></label>\n        <label>Type<input data-field=\"type\" value=\"${item?.type ?? \"\"}\" /></label>\n        <label>Description<input data-field=\"description\" value=\"${item?.description ?? \"\"}\" /></label>\n        <label>Notes<input data-field=\"notes\" value=\"${item?.notes ?? \"\"}\" /></label>\n        <label>Quantity<input data-field=\"count\" type=\"number\" step=\"1\" min=\"0\" value=\"${item?.count ?? \"\"}\" /></label>\n      </div>\n    `;\n    const nameInput = row.querySelector<HTMLInputElement>('[data-field=\"name\"]');\n    const title = row.querySelector<HTMLSpanElement>('[data-role=\"row-title\"]');\n    nameInput?.addEventListener(\"input\", () => {\n      if (title) title.textContent = nameInput.value || \"New equipment\";\n    });\n    this.equipmentListEl.appendChild(row);\n  }\n\n  private collectFormData(): Unit {\n    const data = new FormData(this.form);\n    const stats: UnitStats = {};\n    const gren: UnitGrenades = {};\n\n    const unit: Unit = {\n      id: this.toInt(data.get(\"unit-id\")),\n      name: this.toStringValue(data.get(\"name\")) ?? \"\",\n      category: this.toStringValue(data.get(\"category\"))?.toUpperCase(),\n      internalCategory: this.toStringValue(data.get(\"internalCategory\")),\n      tier: this.toStringValue(data.get(\"tier\")),\n      price: this.toInt(data.get(\"price\")),\n      image: this.toStringValue(data.get(\"image\")),\n      description: this.toStringValue(data.get(\"description\")),\n    };\n\n    const statFields: (keyof UnitStats)[] = [\n      \"armor\",\n      \"health\",\n      \"squadSize\",\n      \"visualRange\",\n      \"stealth\",\n      \"speed\",\n      \"weight\",\n    ];\n    statFields.forEach((key) => {\n      const value = this.toNumber(data.get(`stats.${key}`));\n      if (value !== undefined) {\n        stats[key] = value;\n      }\n    });\n    if (Object.keys(stats).length) unit.stats = stats;\n\n    const grenFields: (keyof UnitGrenades)[] = [\"smoke\", \"flash\", \"thermite\", \"frag\", \"total\"];\n    grenFields.forEach((key) => {\n      const value = this.toInt(data.get(`grenades.${key}`));\n      if (value !== undefined) {\n        gren[key] = value;\n      }\n    });\n    if (Object.keys(gren).length) unit.grenades = gren;\n\n    const capabilities: Unit[\"capabilities\"] = {};\n    const staticLineJump = parseBool(data.get(\"cap.staticLineJump\"));\n    if (staticLineJump !== undefined) capabilities.staticLineJump = staticLineJump;\n    const haloHaho = parseBool(data.get(\"cap.haloHaho\"));\n    if (haloHaho !== undefined) capabilities.haloHaho = haloHaho;\n    const laser = parseBool(data.get(\"cap.laserDesignator\"));\n    if (laser !== undefined) capabilities.laserDesignator = laser;\n\n    const sprintDistance = this.toNumber(data.get(\"cap.sprint.distance\"));\n    const sprintSpeed = this.toNumber(data.get(\"cap.sprint.speed\"));\n    const sprintCooldown = this.toNumber(data.get(\"cap.sprint.cooldown\"));\n    if (sprintDistance !== undefined || sprintSpeed !== undefined || sprintCooldown !== undefined) {\n      capabilities.sprint = {\n        distance: sprintDistance,\n        speed: sprintSpeed,\n        cooldown: sprintCooldown,\n      };\n    }\n    if (Object.keys(capabilities).length) unit.capabilities = capabilities;\n\n    unit.guns = this.collectGunRows();\n    unit.equipment = this.collectEquipmentRows();\n\n    return unit;\n  }\n\n  private collectGunRows(): Gun[] {\n    const rows = Array.from(this.gunListEl.querySelectorAll<HTMLElement>(\".repeatable-row\"));\n    const guns: Gun[] = [];\n    rows.forEach((row) => {\n      const gun: Gun = {};\n      const str = (key: string) =>\n        row.querySelector<HTMLInputElement>(`[data-field=\"${key}\"]`)?.value.trim() ?? \"\";\n      const num = (key: string) => this.parseNumberString(str(key));\n      const int = (key: string) => this.parseIntegerString(str(key));\n\n      gun.name = str(\"name\") || undefined;\n      gun.category = str(\"category\") || undefined;\n      gun.caliber = str(\"caliber\") || undefined;\n      gun.barrelLength = num(\"barrelLength\");\n      gun.range = num(\"range\");\n      gun.dispersion = num(\"dispersion\");\n      gun.count = int(\"count\");\n      gun.ammoPerSoldier = int(\"ammoPerSoldier\");\n      gun.totalAmmo = int(\"totalAmmo\");\n      if (!gun.totalAmmo && gun.count && gun.ammoPerSoldier) {\n        gun.totalAmmo = gun.count * gun.ammoPerSoldier;\n      }\n      gun.magazineSize = int(\"magazineSize\");\n      gun.reloadSpeed = num(\"reloadSpeed\");\n      gun.targetAcquisition = num(\"targetAcquisition\");\n\n      const ammoRows = Array.from(row.querySelectorAll<HTMLElement>(\".ammo-row\"));\n      const ammoTypes: GunAmmo[] = ammoRows\n        .map((ammoRow) => {\n          const text = (key: string) =>\n            ammoRow.querySelector<HTMLInputElement | HTMLSelectElement>(`[data-ammo-field=\"${key}\"]`)?.value.trim() ?? \"\";\n          const numberValue = (key: string) => this.parseNumberString(text(key));\n          const intValue = (key: string) => this.parseIntegerString(text(key));\n          const ammo: GunAmmo = {\n            name: text(\"name\") || undefined,\n            ammoType: text(\"ammoType\") || undefined,\n            caliberDesc: text(\"caliberDesc\") || undefined,\n            ammoPerSoldier: intValue(\"ammoPerSoldier\"),\n            penetration: numberValue(\"penetration\"),\n            heDeadliness: numberValue(\"heDeadliness\"),\n            dispersion: numberValue(\"dispersion\"),\n            rangeMod: numberValue(\"rangeMod\"),\n            grain: numberValue(\"grain\"),\n            notes: text(\"notes\") || undefined,\n            fps: numberValue(\"fps\"),\n            subCount: intValue(\"subCount\"),\n            subDamage: numberValue(\"subDamage\"),\n            subPenetration: numberValue(\"subPenetration\"),\n          };\n          const airburst = text(\"airburst\");\n          if (airburst === \"yes\") ammo.airburst = true;\n          else if (airburst === \"no\") ammo.airburst = false;\n          const hasContent = Object.values(ammo).some((value) => value !== undefined && value !== \"\");\n          return hasContent ? ammo : null;\n        })\n        .filter((ammo): ammo is GunAmmo => Boolean(ammo));\n      if (ammoTypes.length) gun.ammoTypes = ammoTypes;\n\n      const fireRows = Array.from(row.querySelectorAll<HTMLElement>(\".fire-row\"));\n      const fireModes: GunFireMode[] = fireRows\n        .map((fireRow) => {\n          const text = (key: string) =>\n            fireRow.querySelector<HTMLInputElement | HTMLSelectElement>(`[data-fire-field=\"${key}\"]`)?.value.trim() ?? \"\";\n          const numberValue = (key: string) => this.parseNumberString(text(key));\n          const intValue = (key: string) => this.parseIntegerString(text(key));\n          const fire: GunFireMode = {\n            name: text(\"name\") || undefined,\n            rounds: intValue(\"rounds\"),\n            burstDuration: numberValue(\"burstDuration\"),\n            cooldown: numberValue(\"cooldown\"),\n            ammoRef: text(\"ammoRef\") || undefined,\n          };\n          const hasContent = Object.values(fire).some((value) => value !== undefined && value !== \"\");\n          return hasContent ? fire : null;\n        })\n        .filter((mode): mode is GunFireMode => Boolean(mode));\n      if (fireModes.length) gun.fireModes = fireModes;\n\n      if (Object.values(gun).some((value) => value !== undefined && value !== \"\")) {\n        guns.push(gun);\n      }\n    });\n    return guns;\n  }\n\n  private collectEquipmentRows(): Equipment[] {\n    const rows = Array.from(this.equipmentListEl.querySelectorAll<HTMLElement>(\".repeatable-row\"));\n    const items: Equipment[] = [];\n    rows.forEach((row) => {\n      const equipment: Equipment = {};\n      const str = (key: string) =>\n        row.querySelector<HTMLInputElement>(`[data-field=\"${key}\"]`)?.value.trim() ?? \"\";\n      const int = (key: string) => this.parseIntegerString(str(key));\n\n      equipment.name = str(\"name\") || undefined;\n      equipment.type = str(\"type\") || undefined;\n      equipment.description = str(\"description\") || undefined;\n      equipment.notes = str(\"notes\") || undefined;\n      equipment.count = int(\"count\");\n\n      if (Object.values(equipment).some((value) => value !== undefined && value !== \"\")) {\n        items.push(equipment);\n      }\n    });\n    return items;\n  }\n\n  private syncSelection(): void {\n    if (this.currentUnitId) {\n      const match = this.units.find((unit) => unit.id === this.currentUnitId);\n      if (match) {\n        this.loadUnit(match);\n        return;\n      }\n    }\n    if (this.pendingName) {\n      const match = this.units.find((unit) => unit.name?.toLowerCase() === this.pendingName);\n      if (match) {\n        this.loadUnit(match);\n        return;\n      }\n    }\n  }\n\n  private toNumber(value: FormDataEntryValue | null): number | undefined {\n    if (value === null) return undefined;\n    return this.parseNumberString(value.toString());\n  }\n\n  private toInt(value: FormDataEntryValue | null): number | undefined {\n    if (value === null) return undefined;\n    return this.parseIntegerString(value.toString());\n  }\n\n  private parseNumberString(value: string): number | undefined {\n    const trimmed = value.trim();\n    if (!trimmed) return undefined;\n    const parsed = Number(trimmed);\n    return Number.isNaN(parsed) ? undefined : parsed;\n  }\n\n  private parseIntegerString(value: string): number | undefined {\n    const trimmed = value.trim();\n    if (!trimmed) return undefined;\n    const parsed = Number.parseInt(trimmed, 10);\n    return Number.isNaN(parsed) ? undefined : parsed;\n  }\n\n  private toStringValue(value: FormDataEntryValue | null): string | undefined {\n    if (value === null) return undefined;\n    const text = value.toString().trim();\n    return text.length ? text : undefined;\n  }\n\n  private setStatus(message: string, tone: \"default\" | \"success\" | \"error\"): void {\n    if (!this.statusEl) return;\n    this.statusEl.textContent = message;\n    this.statusEl.dataset.tone = tone;\n  }\n\n  private setSummary(message: string): void {\n    if (this.summaryEl) {\n      this.summaryEl.textContent = message;\n    }\n  }\n\n  private updateTemplateLibraries(units: Unit[]): void {\n    const ammoMap = new Map<string, GunAmmo>();\n    const fireMap = new Map<string, GunFireMode>();\n    const ammoPerCaliber = new Map<string, GunAmmo[]>();\n    units.forEach((unit) => {\n      (unit.guns || []).forEach((gun) => {\n        (gun.ammoTypes || []).forEach((ammo, index) => {\n          const key = `${(ammo.name || `Ammo${index}`)?.toLowerCase()}-${ammo.ammoType || \"\"}`;\n          if (!ammoMap.has(key)) ammoMap.set(key, deepClone(ammo));\n          const calKey = (gun.caliber || \"generic\").toLowerCase();\n          const bucket = ammoPerCaliber.get(calKey) ?? [];\n          bucket.push(deepClone(ammo));\n          ammoPerCaliber.set(calKey, bucket);\n          const genericBucket = ammoPerCaliber.get(\"generic\") ?? [];\n          genericBucket.push(deepClone(ammo));\n          ammoPerCaliber.set(\"generic\", genericBucket);\n        });\n        (gun.fireModes || []).forEach((mode, index) => {\n          const key = `${(mode.name || `Mode${index}`)?.toLowerCase()}`;\n          if (!fireMap.has(key)) fireMap.set(key, deepClone(mode));\n        });\n      });\n    });\n    this.ammoTemplates = Array.from(ammoMap.values());\n    this.fireTemplates = Array.from(fireMap.values());\n    this.ammoLibraryByCaliber = ammoPerCaliber;\n  }\n}\n\r\n","import type { Formation, FormationCategory } from \"../types\";\nimport { formationService } from \"../services/formationService\";\nimport { unitService } from \"../services/unitService\";\n\nconst createFormation = (): Formation => ({\n  name: \"New Formation\",\n  description: \"\",\n  image: \"\",\n  categories: [],\n});\n\nexport class FormationsPanel {\n  private root: HTMLElement;\n  private listEl!: HTMLElement;\n  private formEl!: HTMLFormElement;\n  private statusEl!: HTMLElement;\n  private categoryListEl!: HTMLElement;\n  private unitsCountEl!: HTMLElement;\n  private formations: Formation[] = [];\n  private unitOptions: { id: number; label: string }[] = [];\n  private subSelectEl!: HTMLSelectElement;\n  private formationOptions: { id: number; name: string }[] = [];\n  private selectedIndex = 0;\n\n  constructor(root: HTMLElement) {\n    this.root = root;\n  }\n\n  init(): void {\n    this.renderLayout();\n    this.cacheElements();\n    this.bindEvents();\n    formationService.subscribe((formations) => {\n      this.formations = formations.length ? formations : [createFormation()];\n      this.formationOptions = formations.map((formation, index) => ({\n        id: formation.id ?? index + 1,\n        name: formation.name || `Formation ${index + 1}`,\n      }));\n      this.renderList();\n      this.syncSelection();\n    });\n    unitService.subscribe((units) => {\n      this.unitOptions = units.map((unit, index) => ({\n        id: unit.id ?? index,\n        label: unit.name || `Unit ${index + 1}`,\n      }));\n      this.renderCategories();\n    });\n    formationService.loadFormations().catch((error) => {\n      this.setStatus(error instanceof Error ? error.message : String(error), \"error\");\n    });\n  }\n\n  private renderLayout(): void {\n    this.root.innerHTML = `\n      <div class=\"panel formations-panel\">\n        <div class=\"panel-heading\">\n          <h3>Formations</h3>\n          <p class=\"muted\">Capture compositions and assign unit categories.</p>\n        </div>\n        <div class=\"split-layout\">\n          <aside class=\"list-pane\">\n            <div class=\"list-actions\">\n              <button type=\"button\" class=\"ghost\" data-action=\"add-formation\">+ Formation</button>\n            </div>\n            <div class=\"list-scroll\" data-role=\"formation-list\"></div>\n          </aside>\n          <section class=\"detail-pane\">\n            <form data-role=\"formation-form\" class=\"grid-3\">\n              <div class=\"field\">\n                <label>Name</label>\n                <input name=\"name\" autocomplete=\"off\" />\n              </div>\n              <div class=\"field\">\n                <label>Description</label>\n                <textarea name=\"description\" rows=\"3\"></textarea>\n              </div>\n              <div class=\"field\">\n                <label>Image</label>\n                <input name=\"image\" placeholder=\"formations/path.png\" />\n              </div>\n              <div class=\"field full\">\n                <div class=\"panel-heading compact\">\n                  <label>Categories</label>\n                  <button type=\"button\" class=\"ghost\" data-action=\"add-category\">Add category</button>\n                </div>\n                <div class=\"category-editor\" data-role=\"category-editor\"></div>\n              </div>\n              <div class=\"field full\">\n                <label>Sub formations</label>\n                <select data-role=\"sub-formations\" multiple size=\"6\"></select>\n              </div>\n              <div class=\"field full\">\n                <button type=\"submit\" class=\"primary\">Save formation</button>\n              </div>\n            </form>\n            <div class=\"status-bar compact\" data-role=\"formation-status\">Select a formation.</div>\n            <div class=\"helper-text\">\n              Unique units assigned: <strong data-role=\"formation-units-count\">0</strong>\n            </div>\n          </section>\n        </div>\n      </div>\n    `;\n  }\n\n  private cacheElements(): void {\n    this.listEl = this.root.querySelector<HTMLElement>('[data-role=\"formation-list\"]')!;\n    this.formEl = this.root.querySelector<HTMLFormElement>('[data-role=\"formation-form\"]')!;\n    this.statusEl = this.root.querySelector<HTMLElement>('[data-role=\"formation-status\"]')!;\n    this.categoryListEl = this.root.querySelector<HTMLElement>('[data-role=\"category-editor\"]')!;\n    this.unitsCountEl = this.root.querySelector<HTMLElement>('[data-role=\"formation-units-count\"]')!;\n    this.subSelectEl = this.root.querySelector<HTMLSelectElement>('[data-role=\"sub-formations\"]')!;\n  }\n\n  private bindEvents(): void {\n    this.listEl.addEventListener(\"click\", (event) => {\n      const button = (event.target as HTMLElement).closest<HTMLButtonElement>(\"[data-index]\");\n      if (!button) return;\n      this.selectedIndex = Number(button.dataset.index);\n      this.syncSelection();\n    });\n    this.formEl.addEventListener(\"submit\", (event) => {\n      event.preventDefault();\n      this.saveFormation();\n    });\n    this.root.addEventListener(\"click\", (event) => {\n      const button = (event.target as HTMLElement).closest<HTMLButtonElement>(\"[data-action]\");\n      if (!button) return;\n      const action = button.dataset.action;\n      if (action === \"add-formation\") {\n        this.addFormation();\n      } else if (action === \"add-category\") {\n        this.appendCategoryRow();\n      } else if (action === \"remove-category\") {\n        button.closest(\".category-row\")?.remove();\n        this.updateUnitsCount(this.collectCategoriesFromDom());\n      }\n    });\n  }\n\n  private addFormation(): void {\n    this.formations.push(createFormation());\n    this.selectedIndex = this.formations.length - 1;\n    this.renderList();\n    this.syncSelection();\n  }\n\n  private renderList(): void {\n    if (!this.formations.length) {\n      this.listEl.innerHTML = '<p class=\"empty\">No formations found.</p>';\n      return;\n    }\n    this.listEl.innerHTML = \"\";\n    this.formations.forEach((formation, index) => {\n      const btn = document.createElement(\"button\");\n      btn.type = \"button\";\n      btn.dataset.index = index.toString();\n      btn.className = `list-pill${index === this.selectedIndex ? \" active\" : \"\"}`;\n      btn.innerHTML = `\n        <span class=\"title\">${formation.name || \"Untitled formation\"}</span>\n        <span class=\"meta\">${formation.categories?.length ?? 0} categories</span>\n      `;\n      this.listEl.appendChild(btn);\n    });\n  }\n\n  private syncSelection(): void {\n    if (!this.formations.length) {\n      this.formations = [createFormation()];\n    }\n    if (this.selectedIndex < 0 || this.selectedIndex >= this.formations.length) {\n      this.selectedIndex = 0;\n    }\n    const formation = this.formations[this.selectedIndex];\n    (this.formEl.elements.namedItem(\"name\") as HTMLInputElement).value = formation.name || \"\";\n    (this.formEl.elements.namedItem(\"description\") as HTMLTextAreaElement).value = formation.description || \"\";\n    (this.formEl.elements.namedItem(\"image\") as HTMLInputElement).value = formation.image || \"\";\n    this.renderList();\n    this.renderCategories();\n    this.setStatus(`Editing ${formation.name || \"formation\"}.`, \"default\");\n  }\n\n  private renderCategories(): void {\n    this.categoryListEl.innerHTML = \"\";\n    const formation = this.formations[this.selectedIndex];\n    const categories = formation.categories || [];\n    if (!categories.length) {\n      const helper = document.createElement(\"p\");\n      helper.className = \"empty\";\n      helper.textContent = \"No categories yet. Add one to assign units.\";\n      this.categoryListEl.appendChild(helper);\n    } else {\n      categories.forEach((category) => this.appendCategoryRow(category));\n    }\n    this.updateUnitsCount(categories);\n  }\n\n  private appendCategoryRow(category?: FormationCategory): void {\n    const row = document.createElement(\"div\");\n    row.className = \"category-row\";\n    row.innerHTML = `\n      <div class=\"field\">\n        <label>Category name</label>\n        <input data-field=\"name\" value=\"${category?.name || \"\"}\" />\n      </div>\n      <div class=\"field\">\n        <label>Assign units</label>\n        <select data-field=\"units\" multiple size=\"5\"></select>\n      </div>\n      <div class=\"row-actions\">\n        <button type=\"button\" class=\"ghost\" data-action=\"remove-category\">Remove</button>\n      </div>\n    `;\n    const select = row.querySelector<HTMLSelectElement>('select[data-field=\"units\"]')!;\n    const selected = new Set((category?.units || []).map((value) => Number(value)));\n    this.populateUnitOptions(select, selected);\n    this.categoryListEl.appendChild(row);\n  }\n\n  private populateUnitOptions(select: HTMLSelectElement, selected: Set<number>): void {\n    select.innerHTML = \"\";\n    if (!this.unitOptions.length) {\n      const option = document.createElement(\"option\");\n      option.textContent = \"No units available\";\n      option.disabled = true;\n      select.appendChild(option);\n      return;\n    }\n    this.unitOptions.forEach(({ id, label }) => {\n      const option = document.createElement(\"option\");\n      option.value = id.toString();\n      option.textContent = label;\n      if (selected.has(id)) option.selected = true;\n      select.appendChild(option);\n    });\n  }\n\n  private collectCategoriesFromDom(): FormationCategory[] {\n    const rows = Array.from(this.categoryListEl.querySelectorAll<HTMLElement>(\".category-row\"));\n    return rows.map((row) => {\n      const nameInput = row.querySelector<HTMLInputElement>('input[data-field=\"name\"]');\n      const select = row.querySelector<HTMLSelectElement>('select[data-field=\"units\"]');\n      const units = select\n        ? Array.from(select.selectedOptions)\n            .map((opt) => Number(opt.value))\n            .filter((value) => !Number.isNaN(value))\n        : [];\n      return {\n        name: (nameInput?.value || \"\").trim(),\n        units,\n      };\n    });\n  }\n\n  private updateUnitsCount(categories: FormationCategory[]): void {\n    const unique = new Set<number>();\n    categories.forEach((category) => (category.units || []).forEach((unitId) => unique.add(unitId)));\n    this.unitsCountEl.textContent = unique.size.toString();\n    this.renderSubFormationOptions();\n  }\n\n  private saveFormation(): void {\n    if (!this.formations.length) return;\n    const formation = { ...this.formations[this.selectedIndex] };\n    formation.name = (this.formEl.elements.namedItem(\"name\") as HTMLInputElement).value.trim();\n    formation.description = (this.formEl.elements.namedItem(\"description\") as HTMLTextAreaElement).value.trim();\n    formation.image = (this.formEl.elements.namedItem(\"image\") as HTMLInputElement).value.trim();\n    formation.categories = this.collectCategoriesFromDom();\n    formation.subFormations = Array.from(this.subSelectEl.selectedOptions)\n      .map((option) => Number(option.value))\n      .filter((value) => !Number.isNaN(value));\n    this.updateUnitsCount(formation.categories || []);\n    this.formations[this.selectedIndex] = formation;\n    formationService\n      .saveFormations(this.formations)\n      .then(() => this.setStatus(\"Formation saved.\", \"success\"))\n      .catch((error) => this.setStatus(error instanceof Error ? error.message : String(error), \"error\"));\n  }\n\n  private renderSubFormationOptions(): void {\n    if (!this.subSelectEl) return;\n    const current = this.formations[this.selectedIndex];\n    this.subSelectEl.innerHTML = \"\";\n    const available = this.formationOptions.filter((option) => option.id && option.id !== current?.id);\n    if (!available.length) {\n      const option = document.createElement(\"option\");\n      option.disabled = true;\n      option.textContent = \"No other formations available\";\n      this.subSelectEl.appendChild(option);\n      return;\n    }\n    available.forEach((option) => {\n      const opt = document.createElement(\"option\");\n      opt.value = option.id.toString();\n      opt.textContent = option.name;\n      if (current?.subFormations?.includes(option.id)) opt.selected = true;\n      this.subSelectEl.appendChild(opt);\n    });\n  }\n\n  private setStatus(message: string, tone: \"default\" | \"success\" | \"error\"): void {\n    this.statusEl.textContent = message;\n    this.statusEl.dataset.tone = tone;\n  }\n}\n","import type { Nation } from \"../types\";\nimport { nationService } from \"../services/nationService\";\nimport { formationService } from \"../services/formationService\";\n\nconst createNation = (): Nation => ({\n  name: \"New Nation\",\n  description: \"\",\n  image: \"\",\n  formations: [],\n});\n\nexport class NationsPanel {\n  private root: HTMLElement;\n  private listEl!: HTMLElement;\n  private formEl!: HTMLFormElement;\n  private statusEl!: HTMLElement;\n  private formationSelectEl!: HTMLSelectElement;\n  private nations: Nation[] = [];\n  private formationOptions: { id: number; name: string }[] = [];\n  private selectedIndex = 0;\n\n  constructor(root: HTMLElement) {\n    this.root = root;\n  }\n\n  init(): void {\n    this.renderLayout();\n    this.cacheElements();\n    this.bindEvents();\n    nationService.subscribe((nations) => {\n      this.nations = nations.length ? nations : [createNation()];\n      this.renderList();\n      this.syncSelection();\n    });\n    formationService.subscribe((formations) => {\n      this.formationOptions = formations.map((formation, index) => ({\n        id: formation.id ?? index,\n        name: formation.name || `Formation ${index + 1}`,\n      }));\n      this.renderFormationSelect();\n    });\n    nationService.loadNations().catch((error) => {\n      this.setStatus(error instanceof Error ? error.message : String(error), \"error\");\n    });\n  }\n\n  private renderLayout(): void {\n    this.root.innerHTML = `\n      <div class=\"panel nations-panel\">\n        <div class=\"panel-heading\">\n          <h3>Nations</h3>\n          <p class=\"muted\">Assign formations to a nation profile.</p>\n        </div>\n        <div class=\"split-layout\">\n          <aside class=\"list-pane\">\n            <div class=\"list-actions\">\n              <button type=\"button\" class=\"ghost\" data-action=\"add-nation\">+ Nation</button>\n            </div>\n            <div class=\"list-scroll\" data-role=\"nation-list\"></div>\n          </aside>\n          <section class=\"detail-pane\">\n            <form data-role=\"nation-form\" class=\"grid-3\">\n              <div class=\"field\">\n                <label>Name</label>\n                <input name=\"name\" autocomplete=\"off\" />\n              </div>\n              <div class=\"field\">\n                <label>Description</label>\n                <textarea name=\"description\" rows=\"3\"></textarea>\n              </div>\n              <div class=\"field\">\n                <label>Image</label>\n                <input name=\"image\" placeholder=\"nations/emblem.png\" />\n              </div>\n              <div class=\"field full\">\n                <div class=\"panel-heading compact\">\n                  <label>Assigned formations</label>\n                  <span class=\"muted small\">Ctrl/Cmd + Click to multi-select</span>\n                </div>\n                <select data-role=\"formation-select\" multiple size=\"6\"></select>\n              </div>\n              <div class=\"field full\">\n                <button type=\"submit\" class=\"primary\">Save nation</button>\n              </div>\n            </form>\n            <div class=\"status-bar compact\" data-role=\"nation-status\">Select a nation.</div>\n          </section>\n        </div>\n      </div>\n    `;\n  }\n\n  private cacheElements(): void {\n    this.listEl = this.root.querySelector<HTMLElement>('[data-role=\"nation-list\"]')!;\n    this.formEl = this.root.querySelector<HTMLFormElement>('[data-role=\"nation-form\"]')!;\n    this.statusEl = this.root.querySelector<HTMLElement>('[data-role=\"nation-status\"]')!;\n    this.formationSelectEl = this.root.querySelector<HTMLSelectElement>('[data-role=\"formation-select\"]')!;\n  }\n\n  private bindEvents(): void {\n    this.listEl.addEventListener(\"click\", (event) => {\n      const button = (event.target as HTMLElement).closest<HTMLButtonElement>(\"[data-index]\");\n      if (!button) return;\n      this.selectedIndex = Number(button.dataset.index);\n      this.syncSelection();\n    });\n    this.formEl.addEventListener(\"submit\", (event) => {\n      event.preventDefault();\n      this.saveNation();\n    });\n    this.root.addEventListener(\"click\", (event) => {\n      const button = (event.target as HTMLElement).closest<HTMLButtonElement>(\"[data-action]\");\n      if (!button) return;\n      if (button.dataset.action === \"add-nation\") {\n        this.addNation();\n      }\n    });\n  }\n\n  private addNation(): void {\n    this.nations.push(createNation());\n    this.selectedIndex = this.nations.length - 1;\n    this.renderList();\n    this.syncSelection();\n  }\n\n  private renderList(): void {\n    if (!this.nations.length) {\n      this.listEl.innerHTML = '<p class=\"empty\">No nations defined.</p>';\n      return;\n    }\n    this.listEl.innerHTML = \"\";\n    this.nations.forEach((nation, index) => {\n      const btn = document.createElement(\"button\");\n      btn.type = \"button\";\n      btn.dataset.index = index.toString();\n      btn.className = `list-pill${index === this.selectedIndex ? \" active\" : \"\"}`;\n      btn.innerHTML = `\n        <span class=\"title\">${nation.name || \"Unnamed nation\"}</span>\n        <span class=\"meta\">${nation.formations?.length ?? 0} formations</span>\n      `;\n      this.listEl.appendChild(btn);\n    });\n  }\n\n  private syncSelection(): void {\n    if (!this.nations.length) {\n      this.nations = [createNation()];\n    }\n    if (this.selectedIndex < 0 || this.selectedIndex >= this.nations.length) {\n      this.selectedIndex = 0;\n    }\n    const nation = this.nations[this.selectedIndex];\n    (this.formEl.elements.namedItem(\"name\") as HTMLInputElement).value = nation.name || \"\";\n    (this.formEl.elements.namedItem(\"description\") as HTMLTextAreaElement).value = nation.description || \"\";\n    (this.formEl.elements.namedItem(\"image\") as HTMLInputElement).value = nation.image || \"\";\n    this.renderList();\n    this.renderFormationSelect();\n    this.setStatus(`Editing ${nation.name || \"nation\"}.`, \"default\");\n  }\n\n  private renderFormationSelect(): void {\n    if (!this.formationSelectEl) return;\n    const nation = this.nations[this.selectedIndex];\n    const selected = new Set((nation?.formations || []).map((value) => Number(value)));\n    this.formationSelectEl.innerHTML = \"\";\n    if (!this.formationOptions.length) {\n      const opt = document.createElement(\"option\");\n      opt.disabled = true;\n      opt.textContent = \"No formations available\";\n      this.formationSelectEl.appendChild(opt);\n      return;\n    }\n    this.formationOptions.forEach(({ id, name }) => {\n      const option = document.createElement(\"option\");\n      option.value = id.toString();\n      option.textContent = name;\n      if (selected.has(id)) option.selected = true;\n      this.formationSelectEl.appendChild(option);\n    });\n  }\n\n  private saveNation(): void {\n    if (!this.nations.length) return;\n    const nation = { ...this.nations[this.selectedIndex] };\n    nation.name = (this.formEl.elements.namedItem(\"name\") as HTMLInputElement).value.trim();\n    nation.description = (this.formEl.elements.namedItem(\"description\") as HTMLTextAreaElement).value.trim();\n    nation.image = (this.formEl.elements.namedItem(\"image\") as HTMLInputElement).value.trim();\n    nation.formations = Array.from(this.formationSelectEl.selectedOptions)\n      .map((option) => Number(option.value))\n      .filter((value) => !Number.isNaN(value));\n    this.nations[this.selectedIndex] = nation;\n    nationService\n      .saveNations(this.nations)\n      .then(() => this.setStatus(\"Nation saved.\", \"success\"))\n      .catch((error) => this.setStatus(error instanceof Error ? error.message : String(error), \"error\"));\n  }\n\n  private setStatus(message: string, tone: \"default\" | \"success\" | \"error\"): void {\n    this.statusEl.textContent = message;\n    this.statusEl.dataset.tone = tone;\n  }\n}\n","import type { AppSettings } from \"../types\";\n\nconst DEFAULT_ACCENT = \"#6dd5fa\";\n\nconst clamp = (value: number, min: number, max: number) => Math.min(Math.max(value, min), max);\n\nconst shadeColor = (hex: string, percent: number): string => {\n  const normalized = hex.replace(\"#\", \"\");\n  if (!/^[0-9a-f]{6}$/i.test(normalized)) return hex;\n  const num = parseInt(normalized, 16);\n  const r = clamp(((num >> 16) & 0xff) + percent * 255, 0, 255);\n  const g = clamp(((num >> 8) & 0xff) + percent * 255, 0, 255);\n  const b = clamp((num & 0xff) + percent * 255, 0, 255);\n  return `#${((1 << 24) + (Math.round(r) << 16) + (Math.round(g) << 8) + Math.round(b)).toString(16).slice(1)}`;\n};\n\nexport const applyTheme = (settings: AppSettings): void => {\n  const root = document.documentElement;\n  const theme = settings.theme || \"\";\n  if (theme) {\n    root.dataset.theme = theme;\n  } else {\n    root.removeAttribute(\"data-theme\");\n  }\n  const accent = typeof settings.accentColor === \"string\" && settings.accentColor ? settings.accentColor : DEFAULT_ACCENT;\n  root.style.setProperty(\"--accent\", accent);\n  root.style.setProperty(\"--accent-dark\", shadeColor(accent, -0.35));\n};\n","import type { AppSettings } from \"../types\";\nimport { settingsService } from \"../services/settingsService\";\nimport { applyTheme } from \"../lib/theme\";\n\nexport class SettingsPanel {\n  private root: HTMLElement;\n  private formEl!: HTMLFormElement;\n  private statusEl!: HTMLElement;\n  private settings: AppSettings = {};\n\n  constructor(root: HTMLElement) {\n    this.root = root;\n  }\n\n  init(): void {\n    this.renderLayout();\n    this.cacheElements();\n    this.bindEvents();\n    settingsService.subscribe((settings) => {\n      this.settings = settings;\n      this.syncForm();\n    });\n    settingsService.loadSettings().catch((error) => {\n      this.setStatus(error instanceof Error ? error.message : String(error), \"error\");\n    });\n  }\n\n  private renderLayout(): void {\n    this.root.innerHTML = `\n      <div class=\"panel settings-panel\">\n        <div class=\"panel-heading\">\n          <h3>Application Settings</h3>\n          <p class=\"muted\">Customize theme, locale, and experimental flags.</p>\n        </div>\n        <form class=\"grid-3\" data-role=\"settings-form\">\n          <div class=\"field\">\n            <label>Theme</label>\n            <select name=\"theme\">\n              <option value=\"\">System Default</option>\n              <option value=\"light\">Light</option>\n              <option value=\"dark\">Dark</option>\n            </select>\n          </div>\n          <div class=\"field\">\n            <label>Locale</label>\n            <input name=\"locale\" placeholder=\"en-US\" />\n          </div>\n          <div class=\"field\">\n            <label>Accent color</label>\n            <input name=\"accentColor\" type=\"color\" value=\"#6dd5fa\" />\n          </div>\n          <div class=\"field\">\n            <label>\n              <input type=\"checkbox\" name=\"enableExperimental\" />\n              Enable experimental modules\n            </label>\n          </div>\n          <div class=\"field full\">\n            <button type=\"submit\" class=\"primary\">Save settings</button>\n          </div>\n        </form>\n        <div class=\"status-bar compact\" data-role=\"settings-status\">Adjust settings and save.</div>\n      </div>\n    `;\n  }\n\n  private cacheElements(): void {\n    this.formEl = this.root.querySelector<HTMLFormElement>('[data-role=\"settings-form\"]')!;\n    this.statusEl = this.root.querySelector<HTMLElement>('[data-role=\"settings-status\"]')!;\n  }\n\n  private bindEvents(): void {\n    this.formEl.addEventListener(\"submit\", (event) => {\n      event.preventDefault();\n      this.persist();\n    });\n  }\n\n  private syncForm(): void {\n    (this.formEl.elements.namedItem(\"theme\") as HTMLSelectElement).value = this.settings.theme || \"\";\n    (this.formEl.elements.namedItem(\"locale\") as HTMLInputElement).value = this.settings.locale || \"\";\n    (this.formEl.elements.namedItem(\"accentColor\") as HTMLInputElement).value =\n      typeof this.settings.accentColor === \"string\" && this.settings.accentColor.startsWith(\"#\")\n        ? this.settings.accentColor\n        : \"#6dd5fa\";\n    (this.formEl.elements.namedItem(\"enableExperimental\") as HTMLInputElement).checked =\n      Boolean(this.settings.enableExperimental);\n  }\n\n  private persist(): void {\n    const payload: AppSettings = {\n      theme: (this.formEl.elements.namedItem(\"theme\") as HTMLSelectElement).value || undefined,\n      locale: (this.formEl.elements.namedItem(\"locale\") as HTMLInputElement).value || undefined,\n      accentColor: (this.formEl.elements.namedItem(\"accentColor\") as HTMLInputElement).value || undefined,\n      enableExperimental: (this.formEl.elements.namedItem(\"enableExperimental\") as HTMLInputElement).checked,\n    };\n    applyTheme(payload);\n    settingsService\n      .saveSettings(payload)\n      .then(() => this.setStatus(\"Settings saved.\", \"success\"))\n      .catch((error) => this.setStatus(error instanceof Error ? error.message : String(error), \"error\"));\n  }\n\n  private setStatus(message: string, tone: \"default\" | \"success\" | \"error\"): void {\n    this.statusEl.textContent = message;\n    this.statusEl.dataset.tone = tone;\n  }\n}\n","import { unitService } from \"../services/unitService\";\nimport { formationService } from \"../services/formationService\";\nimport { nationService } from \"../services/nationService\";\n\nexport class StatsPanel {\n  private root: HTMLElement;\n  private unitCountEl!: HTMLElement;\n  private formationCountEl!: HTMLElement;\n  private nationCountEl!: HTMLElement;\n  private favoriteCategoryEl!: HTMLElement;\n\n  constructor(root: HTMLElement) {\n    this.root = root;\n  }\n\n  init(): void {\n    this.renderLayout();\n    unitService.subscribe((units) => {\n      this.unitCountEl.textContent = units.length.toString();\n      const categories = units.reduce<Record<string, number>>((map, unit) => {\n        const key = (unit.category || \"Unknown\").toUpperCase();\n        map[key] = (map[key] || 0) + 1;\n        return map;\n      }, {});\n      const favorite = Object.entries(categories).sort((a, b) => b[1] - a[1])[0];\n      this.favoriteCategoryEl.textContent = favorite ? `${favorite[0]} (${favorite[1]})` : \"—\";\n    });\n\n    formationService.subscribe((formations) => {\n      this.formationCountEl.textContent = formations.length.toString();\n    });\n\n    nationService.subscribe((nations) => {\n      this.nationCountEl.textContent = nations.length.toString();\n    });\n  }\n\n  private renderLayout(): void {\n    this.root.innerHTML = `\n      <div class=\"panel stats-panel\">\n        <div class=\"panel-heading\">\n          <h3>Force Overview</h3>\n          <p class=\"muted\">Live metrics pulled from SQLite</p>\n        </div>\n        <div class=\"stats-grid\">\n          <div class=\"stat-card\">\n            <span class=\"label\">Units</span>\n            <strong data-role=\"stat-units\">0</strong>\n          </div>\n          <div class=\"stat-card\">\n            <span class=\"label\">Formations</span>\n            <strong data-role=\"stat-formations\">0</strong>\n          </div>\n          <div class=\"stat-card\">\n            <span class=\"label\">Nations</span>\n            <strong data-role=\"stat-nations\">0</strong>\n          </div>\n          <div class=\"stat-card\">\n            <span class=\"label\">Top category</span>\n            <strong data-role=\"stat-category\">—</strong>\n          </div>\n        </div>\n        <p class=\"muted\">Radar visualizations and legacy views will return here soon.</p>\n      </div>\n    `;\n    this.unitCountEl = this.root.querySelector<HTMLElement>('[data-role=\"stat-units\"]')!;\n    this.formationCountEl = this.root.querySelector<HTMLElement>('[data-role=\"stat-formations\"]')!;\n    this.nationCountEl = this.root.querySelector<HTMLElement>('[data-role=\"stat-nations\"]')!;\n    this.favoriteCategoryEl = this.root.querySelector<HTMLElement>('[data-role=\"stat-category\"]')!;\n  }\n}\n","import \"./styles/main.scss\";\nimport { hostBridge } from \"./lib/hostBridge\";\nimport { UnitEditor } from \"./modules/unitEditor\";\nimport { FormationsPanel } from \"./modules/formationsPanel\";\nimport { NationsPanel } from \"./modules/nationsPanel\";\nimport { SettingsPanel } from \"./modules/settingsPanel\";\nimport { StatsPanel } from \"./modules/statsPanel\";\nimport { unitService } from \"./services/unitService\";\nimport { formationService } from \"./services/formationService\";\nimport { nationService } from \"./services/nationService\";\nimport { settingsService } from \"./services/settingsService\";\nimport { applyTheme } from \"./lib/theme\";\n\ntype PanelDefinition = {\n  key: string;\n  label: string;\n  description: string;\n  group: \"Editors\" | \"Insights\";\n  factory: (container: HTMLElement) => { init: () => void | Promise<void> };\n};\n\nconst panels: PanelDefinition[] = [\n  {\n    key: \"units\",\n    label: \"Units\",\n    description: \"Edit and score tactical units\",\n    group: \"Editors\",\n    factory: (container) => new UnitEditor(container),\n  },\n  {\n    key: \"formations\",\n    label: \"Formations\",\n    description: \"Structure categories per formation\",\n    group: \"Editors\",\n    factory: (container) => new FormationsPanel(container),\n  },\n  {\n    key: \"nations\",\n    label: \"Nations\",\n    description: \"Assign formations to nations\",\n    group: \"Editors\",\n    factory: (container) => new NationsPanel(container),\n  },\n  {\n    key: \"settings\",\n    label: \"Settings\",\n    description: \"Application preferences\",\n    group: \"Editors\",\n    factory: (container) => new SettingsPanel(container),\n  },\n  {\n    key: \"insights\",\n    label: \"Insights\",\n    description: \"Force readiness overview\",\n    group: \"Insights\",\n    factory: (container) => new StatsPanel(container),\n  },\n];\n\nconst root = document.querySelector<HTMLDivElement>(\"#app\");\n\nif (root) {\n  root.innerHTML = `\n    <div class=\"app-layout\">\n      <aside class=\"primary-nav\">\n        <div class=\"brand\">\n          <span class=\"eyebrow\">Philly's RTS Toolkit</span>\n          <h1>Operations Console</h1>\n        </div>\n        <nav class=\"nav-sections\" data-role=\"nav-container\"></nav>\n      </aside>\n      <main class=\"view-host\" data-role=\"view-host\"></main>\n    </div>\n  `;\n\n  const navContainer = root.querySelector<HTMLElement>('[data-role=\"nav-container\"]')!;\n  const host = root.querySelector<HTMLElement>('[data-role=\"view-host\"]')!;\n  const instances = new Map<string, { node: HTMLElement }>();\n  const navBadges = new Map<string, HTMLElement>();\n  const groupLists = new Map<string, HTMLElement>();\n\n  panels.forEach((panel, index) => {\n    let list = groupLists.get(panel.group);\n    if (!list) {\n      const section = document.createElement(\"div\");\n      section.className = \"nav-section\";\n      const label = document.createElement(\"p\");\n      label.className = \"section-label\";\n      label.textContent = panel.group;\n      list = document.createElement(\"div\");\n      list.className = \"nav-list\";\n      section.append(label, list);\n      navContainer.appendChild(section);\n      groupLists.set(panel.group, list);\n    }\n    const button = document.createElement(\"button\");\n    button.type = \"button\";\n    button.className = \"nav-chip\";\n    button.dataset.panel = panel.key;\n    button.innerHTML = `\n      <div class=\"nav-chip-head\">\n        <span class=\"label\">${panel.label}</span>\n        <span class=\"badge\" data-panel-count=\"${panel.key}\">--</span>\n      </div>\n      <span class=\"meta\">${panel.description}</span>\n    `;\n    list!.appendChild(button);\n    const badge = button.querySelector<HTMLElement>(`[data-panel-count=\"${panel.key}\"]`);\n    if (badge) navBadges.set(panel.key, badge);\n\n    const section = document.createElement(\"section\");\n    section.className = \"view-panel\";\n    section.dataset.panel = panel.key;\n    host.appendChild(section);\n\n    const controller = panel.factory(section);\n    Promise.resolve(controller.init()).catch((error) => {\n      console.error(`Failed to init ${panel.key}`, error);\n    });\n\n    instances.set(panel.key, { node: section });\n\n    if (index === 0) {\n      button.classList.add(\"active\");\n      section.classList.add(\"active\");\n    }\n  });\n\n  navContainer.addEventListener(\"click\", (event) => {\n    const button = (event.target as HTMLElement).closest<HTMLButtonElement>(\".nav-chip\");\n    if (!button) return;\n    const panelKey = button.dataset.panel;\n    if (!panelKey) return;\n\n    navContainer.querySelectorAll(\".nav-chip\").forEach((chip) => chip.classList.remove(\"active\"));\n    button.classList.add(\"active\");\n\n    host.querySelectorAll(\".view-panel\").forEach((panel) => panel.classList.remove(\"active\"));\n    instances.get(panelKey)?.node.classList.add(\"active\");\n  });\n\n  const updateBadge = (key: string, value: string) => {\n    const el = navBadges.get(key);\n    if (el) el.textContent = value;\n  };\n\n  unitService.subscribe((units) => updateBadge(\"units\", `${units.length} units`));\n  formationService.subscribe((formations) => updateBadge(\"formations\", `${formations.length} groups`));\n  nationService.subscribe((nations) => updateBadge(\"nations\", `${nations.length} nations`));\n  settingsService.subscribe((settings) => {\n    updateBadge(\"settings\", settings.theme ? settings.theme : \"System\");\n    applyTheme(settings);\n  });\n  updateBadge(\"insights\", \"Live metrics\");\n\n  unitService.loadUnits().catch(() => undefined);\n  formationService.loadFormations().catch(() => undefined);\n  nationService.loadNations().catch(() => undefined);\n  settingsService.loadSettings().catch(() => undefined);\n}\n\nif (hostBridge.isAvailable) {\n  hostBridge.postMessage(\"host-info-request\");\n  hostBridge.waitFor<{ version?: string; mode?: string }>(\"host-info\", 2000).then((info) => {\n    console.info(\"[Host]\", info);\n  });\n}\n"],"names":["HostBridge","__publicField","_a","_c","_b","event","envelope","type","payload","responseType","timeoutMs","waitType","waitPromise","resolve","reject","handler","timeoutId","existing","set","error","hostBridge","deepClone","obj","UnitService","unit","id","callback","snapshot","subscriber","unitService","FormationService","next","formations","formation","formationService","NationService","nations","nation","nationService","SettingsService","settings","settingsService","createBlankUnit","booleanToSelectValue","value","parseBool","UnitEditor","root","units","message","button","index","action","row","search","categoryFilter","items","sortMode","b","btn","match","u","setValue","name","field","stats","caps","gren","guns","gun","equipment","nameInput","title","ammoSection","ammoHeader","ammoActions","ammoLibrarySelect","populateAmmoLibrary","tpl","option","template","appendAmmoRow","refreshFireAmmoOptions","addAmmoBtn","ammoList","fireSection","fireHeader","fireActions","fireLibrarySelect","populateFireLibrary","appendFireRow","addFireBtn","fireList","ammo","ammoRow","grainInput","fpsInput","getBarrelLength","applyBallistics","grain","barrel","velocity","mode","fireRow","getAmmoNames","input","names","select","current","empty","opt","item","data","key","capabilities","staticLineJump","haloHaho","laser","sprintDistance","sprintSpeed","sprintCooldown","rows","str","num","int","ammoTypes","text","numberValue","intValue","airburst","fireModes","fire","trimmed","parsed","tone","ammoMap","fireMap","ammoPerCaliber","calKey","bucket","genericBucket","createFormation","FormationsPanel","categories","category","helper","selected","label","unique","unitId","available","createNation","NationsPanel","DEFAULT_ACCENT","clamp","min","max","shadeColor","hex","percent","normalized","r","g","applyTheme","theme","accent","SettingsPanel","StatsPanel","map","favorite","a","panels","container","navContainer","host","instances","navBadges","groupLists","panel","list","section","badge","controller","panelKey","chip","updateBadge","el","info"],"mappings":"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"}